function qmeanLocalColour(a,z){return.4<a?null==z?"rgb("+Math.round(1/.6*(1-a)*255)+",80,"+Math.round(1/.6*(a-.4)*255)+")":"rgba("+Math.round(1/.6*(1-a)*255)+",80,"+Math.round(1/.6*(a-.4)*255)+","+z+")":null==z?"rgb(255,80,0)":"rgba(255,80,0,"+z+")"}
function drawQMEANLocal(a,z,m,F,h,G,E){var l=G?"qmb":"qm",A=["lq-chart"+(m?"-"+m:"")];if(h||!(0<$("#"+A[0]+" svg").length)){a=chainMapping.structures[a];for(h=0;h<Object.keys(a).length;h++){var c="lq-chart"+(m?"-"+m:"");0==h&&(0==$("#"+c).length?$("body").append("<div"+(m?' rel="'+m+'"':"")+' id="'+c+'" style="display:none"></div>'):$("#"+c).empty(),$("#"+c+"-thumb").empty());if(1==Object.keys(a).length)break;c+="-"+Object.keys(a)[h];A.push(c);0==$("#"+c).length?$("body").append("<div"+(m?' rel="'+
m+'"':"")+' id="'+c+'" style="display:none"></div>'):$("#"+c).empty();0==$('a[href="#'+c+'"]').length&&$("body").append('<a href="#'+c+'" rel="lq-'+(m?m:"")+'" class="fancybox"/>')}h=!0;E||(E=200);for(c=0;c<A.length;c++){var r=0,u=0,w=0,D=!1;if(h){$("#"+A[c]+"-thumb").attr("title","Click to enlarge");var x=$("#"+A[c]+"-thumb").closest(":visible").width();var e=$("#"+A[c]+"-thumb").closest(":visible").height();if(null==x||null==e)break;0==e&&(e=Math.min(E,.5*x));if(e>=E){var n=12;r=45;u=30;w=40;D=
!0}else F&&(r=30,u=16),n=Math.max(15,e/10)}else n=20,r=45,u=30,w=40,x=.7*$(window).width()+r,e=.7*$(window).height()+w+u;for(var y=Raphael(A[c]+(h?"-thumb":""),x,e),f=99999,p=0,v=0,g=0,k=999,t=0,d=Object.keys(a),b=0;b<d.length;b++)if(!(0<c&&c-1!=b))for(var q=0;q<a[d[b]].length;q++)a[d[b]][q]&&a[d[b]][q][l]&&(k=Math.min(k,a[d[b]][q][l]),t=Math.max(t,a[d[b]][q][l]),f=Math.min(a[d[b]][q].resno,f),p=Math.max(a[d[b]][q].resno,p),g+=1,v+=a[d[b]][q][l]);t=1>=t;q=1;t?k=Math.min(.3,k):(q=100,k=Math.min(70,
k));null==z&&(z=v/g);$("#avgLocalQMEAN,#avgLocalScore_"+m).html(isNaN(z)?"-":z.toFixed(2));v=e-w-u;g=(x-r)/(p-f);y.rect(0,0,x,e).attr({fill:"#FFF",stroke:"#FFF"});if(h&&!D)y.rect(r,u,x-r,v).attr({stroke:"#DDD"}),F&&(y.text(x/2,8,"Local Quality Estimate").attr({"text-anchor":"middle",fill:"#444","font-size":Math.max(8,e/24)}),y.text(6,e/2+u/2,"Predicted Local").attr({"text-anchor":"middle",fill:"#666","font-size":Math.max(8,e/26)}).rotate(270,6,e/2+u/2),y.text(18,e/2+u/2,"Similarity to Target").attr({"text-anchor":"middle",
fill:"#666","font-size":Math.max(8,e/26)}).rotate(270,18,e/2+u/2));else{y.rect(r,u,x-r,v).attr({stroke:"#DDD"});D=14;b="Local Quality Estimate";G&&(b+=" (QMEANBrane) ");b=0==c?1==d.length?b+(" - Chain "+d[0]):b+" - All Chains":b+(" - Chain "+d[c-1]);y.text(x/2,10,b).attr({"text-anchor":"middle",fill:"#444","font-size":Math.max(8,e/26)});h?(y.text(6,e/2,"Predicted Local").attr({"text-anchor":"middle",fill:"#666","font-size":n}).rotate(270,6,e/2),y.text(18,e/2,"Similarity to Target").attr({"text-anchor":"middle",
fill:"#666","font-size":n}).rotate(270,18,e/2),D=.8*n):y.text(10,e/2,"Predicted Local Similarity to Target").attr({dy:10,"text-anchor":"middle",fill:"#666","font-size":n}).rotate(270,10,e/2);y.text(r+(x-r)/2,e-8,"Residue Number").attr({"text-anchor":"middle",fill:"#666","font-size":n});n=null;for(b=q;b>=k;b-=t?.1:10){y.path("M"+r+" "+(v/(q-k)*(q-b)+u)+"L"+(r-5)+" "+(v/(q-k)*(q-b)+u)).attr({stroke:"#CCC","stroke-width":1});var B=v/(q-k)*(q-b)+u;if(!B||n+D<B)y.text(r-12,B,b.toFixed(t?1:0)).attr({fill:"#444",
"font-size":D}),n=B}n=Math.floor((p-f)/8);n-=n%10;n=Math.max(10,n);var C=null;for(b=f;b<p;b++)0==b%n&&(B=r+(b-f)/(p-f)*(x-r),C&&C>B||(C=y.text(B,e-w+12,b).attr({fill:"#444","font-size":D}),C=B+C.getBBox().width))}x="#999999 #E69F00 #56B4E9 #009E73 #F0E442 #0072B2 #D55E00 #CC79A7".split(" ");for(w=e=0;w<d.length;w++){p=null;if(0==c||c-1==w){b=v/(q-Math.min(k,z))*(q-z)+u;for(D=0;D<a[d[w]].length;D++)a[d[w]][D]&&(n=a[d[w]][D][l],null!=n&&(B=r+g*(a[d[w]][D].resno-f),C=b-v/(q-k)*(n-z),0==c&&1<d.length?
(C=Math.min(C,v+u),p=null==p?"M"+B+" "+C:p+("L"+B+" "+C),p+="L"+(B+g)+" "+C):(n>z?bar=y.rect(B,C,g,v/(q-k)*(n-z)):(C=v/(q-k)*(z-n),C=Math.min(C,v-b+u),bar=y.rect(B,b,g,C)),n=qmeanLocalColour(t?n:n/100),bar.attr({stroke:n,"stroke-width":.7,fill:n,"fill-opacity":.4}))));0==c&&1<d.length&&(p=y.path(p),p.attr({stroke:x[e],"stroke-width":h?1:1.5}),h||$("#lq-chart"+(m?"-"+m:"")).append((0==w?"<br>Key: ":"")+' <span style="margin-right:4px; color:'+x[e]+'">Chain '+d[w]+";</span>"))}e=++e%x.length}h&&(h=
!1,c--)}}}
function drawQMEANGlobal(a,z,m,F,h){var G=$("#qn-chart"+(m?"-"+m:"")+"-thumb,#qn-chart"+(m?"-"+m:""));if(a&&(m="qmeanGlobalTbl"+(m?m:""),h||!(0<$("#"+m+" tr").length))){G.empty();$("#"+m+" tr").remove();a.QMEAN4&&(a.qmean4_norm_score=a.qmean4_norm,delete a.qmean4_norm,a.qmean4_z_score=a.QMEAN4,delete a.QMEAN4,a.cbeta_z_score=a.cbeta,delete a.cbeta,a.interaction_z_score=a.all_atom,delete a.all_atom,a.packing_z_score=a.solvation,delete a.solvation,a.torsion_z_score=a.torsion,delete a.torsion);a.qmean4&&
(a.qmean4_norm_score=parseFloat(a.qmean4.norm),a.qmean4_z_score=parseFloat(a.qmean4.zscore),delete a.qmean4,a.cbeta_z_score=parseFloat(a.cbeta.zscore),delete a.cbeta,a.interaction_z_score=parseFloat(a.all_atom.zscore),delete a.all_atom,a.packing_z_score=parseFloat(a.solvation.zscore),delete a.solvation,a.torsion_z_score=parseFloat(a.torsion.zscore),delete a.torsion,delete a.acc_agreement,delete a.ss_agreement,delete a.qmean6);h=[["qmean4_z_score","QMEAN"],["cbeta_z_score","C\u03b2"],["interaction_z_score",
"All Atom"],["packing_z_score","solvation"],["torsion_z_score","torsion"]];for(var E="",l=0;l<h.length;l++)null!=a[h[l][0]]&&(E+='<tr><td width="1">'+h[l][1]+'</td><td width="100%" style="padding:0px 2px 0px 2px;"><div id="'+m+"_"+h[l][0]+'">&nbsp;</div></td><td width="1" nowrap="nowrap" style="text-align:right">'+a[h[l][0]].toFixed(2)+"</td></tr>");$("#"+m).append(E);E=$("#"+m+"_"+h[0][0]).innerWidth();var A=$("#"+m+"_"+h[0][0]).parent().innerHeight();if(1>E||1>A)E=290,A=20;for(l=0;l<h.length;l++)$("#"+
m+"_"+h[l][0]).html("");for(var c=E/8,r=0;r<h.length;r++)if(null!=a[h[r][0]]){var u=Raphael(m+"_"+h[r][0],E,A);u.rect(0,0,E,A).attr({fill:"0-rgb(245,61,61)-#fff:75-rgb(77,77,255)"});var w=A/4;for(l=1;8>l;l++)u.path("M"+c*l+" 0L"+c*l+" "+w).attr({stroke:"#555"}),u.path("M"+c*l+" "+(A-w)+"L"+c*l+" "+A).attr({stroke:"#555"});a&&(l=a[h[r][0]],l=Math.min(l,1.95),l=Math.max(l,-5.95),u.path("M"+(c*l+6*c)+" 0L"+(c*l+6*c)+" "+A).attr({stroke:"#222","stroke-width":3}))}var D=a.qmean4_norm_score,x=Math.min(600,
z),e=!0;G.each(function(n,y){var f=0,p=0,v=0;if(e){$(this).attr("title","Click to enlarge");var g=$(this).closest(":visible").width();if(340<g){var k=12;f=45;p=30;v=40;g-=f;var t=400/620*g-v+p}else t=.5*g,F&&(f=15,p=30),k=Math.max(15,t/10)}else k=20,f=45,p=30,v=40,g=617+f,t=398+v+p;var d=Raphael($(this).attr("id"),g,t),b=t-v-p,q=x/600*(g-f)+f,B=b-D/1.5*b+p;d.rect(0,0,g,t).attr({fill:"#FFF",stroke:"#FFF"});"undefined"===typeof localQMEANNormImage?d.image("/static/images/qmean_norm.png",f,p,g-f,b):
d.image(localQMEANNormImage,f,p,g-f,b);d.rect(f,p,g-f,b).attr({stroke:"#DDD"});d.text(q,B,String.fromCharCode(9733)).attr({"text-anchor":"middle",fill:"#F44","font-size":k});if(e)F&&(d.text((g+f)/2,8,"Comparison with Non-redundant").attr({"text-anchor":"middle",fill:"#444","font-size":Math.max(8,g/32)}),d.text((g+f)/2,22,"Set of PDB Structures").attr({"text-anchor":"middle",fill:"#444","font-size":Math.max(8,g/32)}),d.text(6,t/2+p/2,"Normalized QMEAN4").attr({"text-anchor":"middle",fill:"#666","font-size":Math.max(8,
g/32)}).rotate(270,6,t/2+p/2)),d.rect(f+1,t-Math.max(16,g/16),g-f-2,Math.max(16,g/16)).attr({fill:"#FFF","stroke-width":0}),d.text(g/2,t-8,"Protein Size (Residues)").attr({"text-anchor":"middle",fill:"#444","font-size":Math.max(8,g/32)});else{d.text((g+f)/2,10,"Comparison with Non-redundant Set of PDB Structures").attr({"text-anchor":"middle",fill:"#444","font-size":k});d.text(10,t/2,"Normalized QMEAN4 Score").attr({"text-anchor":"middle",fill:"#666","font-size":k}).rotate(270,10,t/2);d.text(f+(g-
f)/2,t-12,"Protein Size (Residues)").attr({"text-anchor":"middle",fill:"#666","font-size":k});for(k=100;600>k;k+=100)d.text(f+k*(g-f)/600,t-v+8,k).attr({fill:"#444","font-size":14});for(k=1.5;0<=k;k-=.5)d.text(f-12,k/1.5*b+p,(1.5-k).toFixed(1)).attr({fill:"#444","font-size":14})}e=!1})}};