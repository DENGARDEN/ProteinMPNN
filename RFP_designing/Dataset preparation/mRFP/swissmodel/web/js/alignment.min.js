var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.createTemplateTagFirstArg=function(g){return g.raw=g};$jscomp.createTemplateTagFirstArgWithRaw=function(g,F){g.raw=F;return g};$jscomp.arrayIteratorImpl=function(g){var F=0;return function(){return F<g.length?{done:!1,value:g[F++]}:{done:!0}}};$jscomp.arrayIterator=function(g){return{next:$jscomp.arrayIteratorImpl(g)}};$jscomp.makeIterator=function(g){var F="undefined"!=typeof Symbol&&Symbol.iterator&&g[Symbol.iterator];return F?F.call(g):$jscomp.arrayIterator(g)};
(function(g){function F(e){return g("#alignNameTbl"+e.attr("id").substring(8))}function R(e){g(document).mouseup(function(){if(g.data(e,"downchain")){var f=g("#offscreen_selection span");if(window.getSelection&&0<f.length){var a=window.getSelection(),l=document.createRange();l.setStart(f.get(0),0);l.setEndAfter(f.get(-1),0);a.addRange(l)}else document.selection&&(document.body.createTextRange(),document.selection.empty());g.data(e,"downchain",null)}e.data("mouseDragEdit",null)});g(document).mousemove(function(){g.data(e,
"downchain")&&(window.getSelection?(windowSelection=window.getSelection(),windowSelection.removeAllRanges()):document.selection&&document.selection.empty())});e.off();if(null==e.data("options")||"textOnly"in e.data("options")&&!e.data("options").textOnly)var d=null;if(e.data("templateData")&&e.data("templateData").charts)e.on("mouseover mousedown mouseup mousemove dblclick","td",function(f){var a=g(this).find("span");if(0!=a.length){var l=a[0].getBoundingClientRect().width,k=g(this);if(f.pageX||f.pageY)var q=
f.pageX-k.offset().left;else if(f.clientX||f.clientY)q=f.clientX+document.body.scrollLeft+document.documentElement.scrollLeft-k.offset().left;$span=g(a[Math.floor(q/l)]);d!=$span.text()?(d=$span.text(),T(e,$span,"mouseover",f,!0)):(d=$span.text(),T(e,$span,f.type,f,!0))}});else e.on("mouseover mousedown mouseup mousemove dblclick","span",function(f){T(e,g(this),f.type,f)})}function T(e,d,f,a,l){var k=d.text();Fa&&S(d,a);if(k!=Ba.gapChar){var q=d.attr("s");if(q){var m=d.closest("tr");a=m.attr("chain");
l=m.attr("keyseqchain");a||(a=m.attr("keyseqchain")?m.attr("keyseqchain"):null);var n=m.attr("struc_id");!n&&m.attr("tpl_id")&&(n=m.attr("tpl_id"));m=e.data("templateData");if("mouseover"==f){if(null!=xa[k.toUpperCase()]){k=xa[k.toUpperCase()].triplet+" "+q+(a?" "+a:"");if(chainMapping.structures[n])for(var v=0;v<chainMapping.annotations.length;v++)if(chainMapping.annotations[v].active&&null!=chainMapping.structures[n][a][q][chainMapping.annotations[v].key]){var u=chainMapping.structures[n][a][q][chainMapping.annotations[v].key];
k+="; "+chainMapping.annotations[v].label+": "+("number"===typeof u?u.toFixed("ramachandran"==chainMapping.annotations[v].key?4:2):u)}d.attr("title",k)}a&&g("body").trigger("highlightResidue",{src:"alignment",struc_id:n,chain:a,resno:parseInt(q)})}if(!Fa&&m)if(m=!("target-template"==m.type&&"target-template"==a),"mousedown"==f)g.data(e,"downspan",d),g.data(e,"downchain",a+l+n),g(".hoverResidue").removeClass("hoverResidue"),g(".selectResidue").removeClass("selectResidue");else if("mousemove"==f||"mouseup"==
f)if(g.data(e,"downchain")&&(window.getSelection?(k=window.getSelection(),k.removeAllRanges(),v=document.createRange()):document.selection&&document.selection.empty()),!a||g.data(e,"downchain")!=a+l+n)g.data(e,"downchain");else if("mousemove"!=f||null==g.data(e,"lastMouseDrag")||g.data(e,"lastMouseDrag")!=a+l+n+d.index()){g.data(e,"lastMouseDrag",a+l+n+d.index());k=e.find("tr["+(l?'keyseqchain="'+l+'"':n?'struc_id="'+n+'"':'chain="'+a+'"')+"]");var y=g.data(e,"downspan"),w=d,z=k.index(y.closest("tr")),
t=k.index(w.closest("tr"));if("mouseup"==f&&y.index()==w.index()&&z==t)d.addClass("selectResidue"),m&&g("body").trigger("centerResRange",{src:"alignment",struc_id:n,chain:l?l:a,min:q,max:q});else{if(z>t||z==t&&y.index()>w.index())q=z,w=y,y=d,z=t,t=q;if(y.index()!=w.index()||z!=t)g(".selectResidue").removeClass("selectResidue"),y.addClass("selectResidue"),w.addClass("selectResidue"),k.each(function(A){A<z||A>t||(A==z?y.nextUntil(w).addClass("selectResidue"):A==t?w.prevUntil(w).addClass("selectResidue"):
g(this).find("span").addClass("selectResidue"))});m&&"mouseup"==f&&g("body").trigger("centerResRange",{src:"alignment",struc_id:n,chain:l?l:a,min:parseInt(y.attr("s")),max:parseInt(w.attr("s"))})}e=e.find(".selectResidue");0<e.length&&(g("#offscreen_selection").html(""),e.clone().appendTo(g("#offscreen_selection")),window.getSelection?(k=window.getSelection(),v=document.createRange(),v.setStart(g("#offscreen_selection span").get(0),0),v.setEndAfter(g("#offscreen_selection span").get(-1),0),k.addRange(v)):
document.selection&&(document.body.createTextRange(),document.selection.empty()))}}}}function S(e,d){d.stopPropagation();d.preventDefault();if(!Ja){var f=e.closest(".alignTbl"),a=e.closest("tr"),l=e.closest("tr").attr("seqno"),k=a.attr("chain");k||(k=a.attr("keyseqtype"),a.attr("keyseqchain"));f.data("templateData");if("mouseover"!=d.type)if("dblclick"==d.type)e.hasClass("shadowCursor")&&(f.data("mouseDragEdit")||("-"==e.text()?qa():ra()));else if("mousedown"==d.type){if(!e.hasClass("shadowCursor")){var q=
g(".shadowCursor").first();if(d.shiftKey&&q)if(q.closest("tr").attr("seqno")==l){g(".shadowCursor").removeClass("shadowCursor");a=f.find("tr[seqno="+l+"]").find("span");k=a.index(q);l=a.index(e);if(k<l)f.data("startEditRegion",q),f.data("endEditRegion",e);else{var m=k;k=l;l=m;f.data("startEditRegion",e);f.data("endEditRegion",q)}a.slice(k,l).each(function(){g(this).addClass("shadowCursor")});f.data("mouseDragEdit",!1)}else return;else g(".shadowCursor").removeClass("shadowCursor"),e.addClass("shadowCursor"),
f.data("mouseDragEdit",!0),f.data("startEditRegion",e),f.data("endEditRegion",e)}g(".cursor").removeClass("cursor");e.addClass("cursor")}else"mousemove"==d.type?((q=window.getSelection?window.getSelection():document.selection)&&(q.removeAllRanges?q.removeAllRanges():q.empty&&q.empty()),f.data("mouseDragEdit")&&(a=f.data("startEditRegion"),0!=a.length&&(f=0,f=d.pageX>a.offset().left?(d.pageX-a.offset().left)/a.outerWidth()|0:(d.pageX-a.offset().left-a.outerWidth())/a.outerWidth()|0,g(".shadowCursor").removeClass("shadowCursor"),
0<f?a.nextAll(":lt("+f+")").addClass("shadowCursor"):0>f&&a.prevAll().slice(0,Math.abs(f)).each(function(){g(this).addClass("shadowCursor")}),a.addClass("shadowCursor")))):"mouseup"==d.type&&(a=f.data("startEditRegion"))&&(a=f.find("tr[seqno="+l+"]").find("span"),k=a.index(q),fa={seqno:l,seqidx:a.index(e)},f.data("startEditRegion",g("span.shadowCursor").first()),f.data("endEditRegion",g("span.shadowCursor").last()),f.data("mouseDragEdit",!1))}}function da(e,d){if(null==d||1>d.length)return!1;var f=
g("body").data("editHistory");null==f&&(f=[]);f.push(d);g("body").data("editHistory",f);f=g(".alignTbl").not(e);0<f.length&&(ea(f,d,!1),g(".cursor").removeClass("cursor"));return!0}function ea(e,d,f,a){e.each(function(){if(null!=g(this).data("templateData")){for(var l=g(this).data("templateData").templates,k=0;k<d.length;k++)for(var q=d[k],m=0;m<q.length;m++)for(var n=0;n<l.length;n++)if(l[n].id==q[m].template.id){f?(l[n].trg_seq=q[m].trg_seq,l[n].tpl_seq=q[m].tpl_seq):(l[n].trg_seq=q[m].template.trg_seq,
l[n].tpl_seq=q[m].template.tpl_seq);a&&(fa=q[m].currentCursor,k==d.length-1&&W(l[n]));break}g(this).is(":visible")&&J(g(this),null,{firstDraw:!1})}})}function W(e){if(!(1>g("#seqid_"+e.id).length)){for(var d=0,f=0,a=0;a<e.trg_seq.length;a++)"-"==e.trg_seq.charAt(a)||"-"==e.tpl_seq.charAt(a)?d++:e.trg_seq.charAt(a)==e.tpl_seq.charAt(a)&&f++;g("#seqid_"+e.id).text((f/(e.trg_seq.length-d)*100).toFixed(2))}}function sa(e,d){null==e&&(38==d.keyCode?e="up":40==d.keyCode?e="down":37==d.keyCode?e="left":
39==d.keyCode&&(e="right"));if(null!=e){d&&d.preventDefault();var f=g("span.cursor").first(),a=f.closest("tr");a.closest(".alignTbl");var l=a.attr("seqno"),k=f.index(),q=k,m=a.prevAll("[seqno="+l+"]");if(0<m.length){var n=m.find("span");q+=n.length}var v=l;if("up"==e&&0<a.index()){var u=a.prev();v=u.attr("seqno");u=u.find("span:eq("+k+")")}else"down"==e&&0<a.next().length?(u=a.next(),v=u.attr("seqno"),u.find("span:eq(rowidx)"),u=a.next().find("span"),u=u.length>k?u.eq(k):u.last()):"left"==e?0==f.prev().length?
0<m.length&&(u=n.last(),q--):(u=f.prev(),q--):"right"==e&&(0<f.next().length?(u=f.next(),q++):(a=a.nextAll("[seqno="+l+"]:eq(0)"),0<a.length&&(u=a.find("span").first(),q++)));null!=u&&(f.removeClass("cursor"),u.addClass("cursor"),fa={seqno:v,seqidx:q})}}function ra(){var e=[],d=g("span.cursor").first(),f=d.closest("tr"),a=f.attr("seqno"),l=f.closest(".alignTbl");if(!d.hasClass("shadowCursor"))if(0==l.find("span.shadowCursor").length)d.addClass("shadowCursor");else return e;if(null==l.data("templateData"))return e;
var k=l.find("span.shadowCursor").last(),q=k.index(),m=k[0]==d[0],n=l.find("tr"),v=k.closest("tr"),u=g(),y=0;n.filter("[seqno="+a+"]").each(function(){y++;var ba=g(this).find("span");if(g(this)[0]==v[0])return u=u.add(ba.slice(0,q+1)),!1;u=u.add(ba)});k=u.index(d);var w=u.text(),z=l.data("templateData").templates;f=null!=f.attr("keyseqchain");for(var t,A,I=f?null:n.filter("[seqno=1]").slice(0,y),K=d.nextAll(".shadowCursor").addBack(),G=0;G<z.length;G++)if(!(null==z[G].selected||1>z[G].selected)){if(f)t=
z[G].trg_seq,A=z[G].tpl_seq,I=n.filter("[seqno="+(z[G].selected+1)+"]").slice(0,y);else if(z[G].selected==a-1)t=z[G].tpl_seq,A=z[G].trg_seq;else continue;I.find("span").slice(0,w.length).text();for(var C="",L=!1,N=!1,D=0;D<w.length;D++)if(D<k)C+=t.charAt(C.length);else if(L)if("-"==w.charAt(D)){C+=t.charAt(C.length-1);N=!0;break}else C+=t.charAt(C.length-1);else C+="-",L=!0;N?t=C+t.substring(C.length):L&&(t=C+t.substring(C.length-1),m||(A=A.substring(0,C.length-1)+"-"+A.substring(C.length-1)));t.length>
A.length?A+=Array(t.length-A.length+1).join("-"):A.length>t.length&&(t+=Array(A.length-t.length+1).join("-"));C={template:z[G],trg_seq:z[G].trg_seq,tpl_seq:z[G].tpl_seq,currentCursor:{seqno:fa.seqno,seqidx:fa.seqidx}};f?(z[G].trg_seq=t,z[G].tpl_seq=A):(z[G].trg_seq=A,z[G].tpl_seq=t);W(z[G]);e[e.length]=C}1==K.length&&g(".shadowCursor").removeClass("shadowCursor");0<e.length?(sa("right"),l.data("templateData"),m&&(l.data("startEditRegion",null),l.data("endEditRegion",null)),da(l,[e])&&J(l,null,{firstDraw:!1})):
ta(d,'<strong style="color:red">The pairwise alignment already contains a gap at this position</strong>')}function ta(e,d){Ja=!0;e.removeAttr("title").popover({html:!0,content:d,placement:"top"}).popover("show");setTimeout(function(){e.popover("destroy");Ja=!1},2E3)}function qa(e){var d=[],f=g("span.cursor").first(),a=f.closest("tr"),l=a.attr("seqno"),k=a.closest(".alignTbl"),q=2>k.find("span.shadowCursor").length;if(e){if("-"!=f.prev().text())return;q&&f.removeClass("shadowCursor");f=f.prev();f.addClass("shadowCursor")}else if("-"!=
f.text())return;if(null==k.data("templateData"))return d;if(!f.hasClass("shadowCursor"))if(0==k.find("span.shadowCursor").length)f.addClass("shadowCursor");else return d;var m=k.find("span.shadowCursor").last(),n=m.index(),v=k.find("tr"),u=m.closest("tr"),y=g(),w=0;v.filter("[seqno="+l+"]").each(function(){w++;var ba=g(this).find("span");if(g(this)[0]==u[0])return y=y.add(ba.slice(0,n+1)),!1;y=y.add(ba)});m=y.index(f);var z=y.text(),t=k.data("templateData").templates;a=null!=a.attr("keyseqchain");
var A="",I=a?null:v.filter("[seqno=1]").slice(0,w);f.nextAll(".shadowCursor").addBack();for(var K=0;K<t.length;K++)if(!(null==t[K].selected||1>t[K].selected)){if(a){var G=t[K].trg_seq;var C=t[K].tpl_seq;I=v.filter("[seqno="+(t[K].selected+1)+"]").slice(0,w)}else if(t[K].selected==l-1)G=t[K].tpl_seq,C=t[K].trg_seq;else continue;A=I.find("span").slice(0,z.length).text();for(var L="",N=!1,D=0;D<z.length;D++)if(D!=m)if(D<m)L+=G.charAt(L.length);else if("-"==z.charAt(D)){if("-"!=A.charAt(D)){if(N)break;
L+="-"}}else N=!0,L+=G.charAt(L.length+1);G=q?L+G.substring(L.length+1):L+"-"+G.substring(L.length+1);G.length>C.length?C+=Array(G.length-C.length+1).join("-"):C.length>G.length&&(G+=Array(C.length-G.length+1).join("-"));A={template:t[K],trg_seq:t[K].trg_seq,tpl_seq:t[K].tpl_seq,currentCursor:{seqno:fa.seqno,seqidx:fa.seqidx}};a?(t[K].trg_seq=G,t[K].tpl_seq=C):(t[K].trg_seq=C,t[K].tpl_seq=G);W(t[K]);d[d.length]=A}0<d.length?(e&&sa("left"),q&&(k.data("startEditRegion",null),k.data("endEditRegion",
null)),da(k,[d])&&J(k,null,{firstDraw:!1})):ta(f,'<strong style="color:red">No valid gaps to be deleted in the selected range</strong>')}function Ca(e,d){var f=0,a=[],l=[],k=[],q="";g.each(e.templates,function(w,z){z&&(!d||z.selected)&&z.trg_seq&&(l[l.length]=z,a[a.length]="",k[k.length]=0,f=Math.max(z.trg_seq.length,f))});l.sort(function(w,z){return w.selected<z.selected?-1:w.selected>z.selected?1:0});if(0!=l.length){var m=null;e.keyseq_sequence?m=e.keyseq_sequence:(m=l[0].trg_seq,e.templates[0].up_res_num||
(m=m.replace(/-/g,"")));for(var n=0;n<f;){for(var v=0,u=0,y=0;y<l.length;y++){for(u=0;l[y].trg_seq.charAt(k[y]+u)==Ba.gapChar;)u++;v=Math.max(u,v)}for(u=0;u<v;)q+=Ba.gapChar,u++;q+=m.charAt(n++);for(y=0;y<l.length;y++)if(l[y].tpl_seq){for(u=0;l[y].trg_seq.charAt(k[y])==Ba.gapChar;)a[y]+=l[y].tpl_seq.charAt(k[y]++),u++;for(;u<v;)a[y]+=Ba.gapChar,u++;a[y]+=l[y].tpl_seq.charAt(k[y]++)}}a.target=q;a.templates=l;W(l[0]);return a}}function X(e,d){var f;e.templates&&(f=Ca(e,!0));if(!f)if(f=[],f.templates=
["empty"],e.keyseq_sequence)f.target=e.keyseq_sequence;else{for(var a=0;a<e.templates.length;a++)if(e.templates[a].trg_seq){f.target=e.templates[a].trg_seq.replace(/-/g,"");break}a=e.templates[a].trg_seq.length-f.target.length;1==e.templates.length&&0<a&&g("#alignmentWarning_"+d.attr("id").substring(8)).html('<div class="alert alert-warning"><button type="button" class="close" data-dismiss="alert">&times;</button><strong>Note: </strong> '+a+" gaps were removed from your target sequence</div>")}return f}
function J(e,d,f){$alignNameTbl=F(e);e.removeData("clustalColours");var a=e.data().templateData;a||(a=g("#alignTbl").data().templateData);if(a){d||(d=X(a,e));for(var l=0,k=0;k<d.length;k++){var q=d[k].match(/[a-zA-Z]/g);q&&(l+=q.length)}l={cols:60,fastDraw:!1,textOnly:2E4<l,showResiduePosition:!0};e.data("options")?f=g.extend(e.data("options"),f):(f||(f={}),!f.cols&&e.attr("cols_cookie")&&g.cookie(e.attr("cols_cookie"))&&(f.cols=g.cookie(e.attr("cols_cookie"))),f=g.extend(l,f));0==f.cols&&(f.cols=
50);f.cols=parseInt(f.cols);k=e.attr("id").substring(8);l=f.fastDraw;f.textOnly?(g("#alignTbl"+k+"_features").remove(),e.off()):l&&(g("#alignTbl"+k+"_features").html(""),(q=Pa["timer"+k])&&clearTimeout(q),f.fastDraw=!1,q=setTimeout(function(){J(e,d)},10),Pa["timer"+k]=q);e.data("options",f);for(k=document.getElementById(e.attr("id"));k.hasChildNodes();)k.removeChild(k.lastChild);for(k=document.getElementById($alignNameTbl.attr("id"));k&&k.hasChildNodes();)k.removeChild(k.lastChild);var m=a.target_name?
a.target_name:"model-template"==a.type?a.struc_id:a.type.split("-")[0];m=m.charAt(0).toUpperCase()+m.substring(1);var n="SEQRES"==m.toUpperCase();var v=void 0!==a.templates?a.templates[0].modelAtomSeqs?a.templates[0].modelAtomSeqs[0].seq.length:d.target.length:d.target.length;q=k="";if(a.nowrap){k='<tr><td style="padding-top:0px;">';q='<tr><td style="padding-top:0px;border-right:none">&nbsp;</td></tr>';for(var u=d.templates[0].trg_offset;u<v+d.templates[0].trg_offset;u++)0<u&&(0<u&&0==u%10?(k+='<span style="position:relative;color:#A2A2A2;">&nbsp;',
k+='<span style="position:absolute;left:0px;top:8px;font-size:.7em;">|</span>',k+='<span style="position:absolute;left:0px;top:0px;font-size:.8em;">'+u+"</span>",k+="</span>"):k+="<span>&nbsp;</span>")}k+="</td></tr>";u={};for(var y={},w=0;w<v;w+=f.cols){for(var z=1,t=0;t<a.keyseq_chain_name.length;t++){var A=[],I=void 0;I=void 0!==a.templates?a.templates[0].modelAtomSeqs?a.templates[0].modelAtomSeqs[t].seq:d.target:d.target;var K=a.keyseq_chain_name[t];q+='<tr seqno="'+z+'" '+Y(a.keyseq_description)+
"><td"+(0<w&&0==t||a.charts?' style="position:relative; padding-top:'+(Da+ya+10)+'px"':"")+">"+(0<Da?'<div style="position:absolute; right:4px; top:'+(Da+ya)/2+'px ">QMEAN</div>':"")+m+(1<a.keyseq_chain_name.length?":"+K:"")+"</td></tr>";var G=d.templates[0].trg_offset?d.templates[0].trg_offset:1;void 0!==a.templates&&a.templates[0].modelAtomSeqs&&(G=a.templates[0].modelAtomSeqs[t].trg_offset);k+='<tr seqno="'+z+'" keyseqtype="'+a.type+'"';!a.struc_id||f.textOnly&&f.fastDraw||(k+=' struc_id="'+a.struc_id+
'" keyseqchain="'+K+'"');k+="><td"+(0<w&&0==t||a.charts?' style="padding-top:'+(Da+ya+10)+'px"':"")+">";f.fastDraw?k+=Ka(I.substring(w,w+f.cols)):f.textOnly?k+="<span>"+I.substring(w,w+f.cols)+"</span>":(k+=U(I.substring(w,w+f.cols),{alIndex:w,pos:P(I.substring(0,w)),offset:G,annotation:a.keyseq_annotation?a.keyseq_annotation[K]:null,seqres:n,up_res_num:a.templates&&a.templates[t]&&a.templates[t].up_res_num?a.templates[t].up_res_num:null,resmap:A,keyseq:!0}),u[K]||(u[K]=[]),u[K]=u[K].concat(A));k+=
"</td></tr>";z+=1}for(t=0;t<d.length;t++)A="model-template"!=a.type&&d.templates[t].struc_id?[]:null,I=a.templates[0].modelAtomSeqs?a.templates[0].modelAtomSeqs[t].seq:d.target,d.templates[t].tpl_seq&&(q+='<tr seqno="'+z+'" '+(null!=d.templates[t].id?'tpl_id="'+d.templates[t].id+'"':"")+' chain="'+d.templates[t].chain+'"'+Y(d.templates[t].description)+'><td nowrap align="left" >'+d.templates[t].qname+"</td></tr>",K=d.templates[t].offset?d.templates[t].offset+1:1,k+='<tr seqno="'+z+'" '+(null!=d.templates[t].id?
'tpl_id="'+d.templates[t].id+'"':"")+(f.textOnly&&f.fastDraw||"model-template"==a.type||!d.templates[t].struc_id?"":' struc_id="'+d.templates[t].struc_id+'"')+' qname="'+d.templates[t].qname+'" chain="'+d.templates[t].chain+'"><td nowrap align="left">',f.fastDraw?k+=Ka(d[t].substring(w,w+f.cols)):f.textOnly?k+="<span>"+d[t].substring(w,w+f.cols)+"</span>":(k+=U(d[t].substring(w,w+f.cols),{alIndex:w,pos:P(d[t].substring(0,w)),offset:K,seqres:n,annotation:d.templates[t].annotation,targetSeq:I.substring(w,
w+f.cols),pdb_res_num:a.templates[t].pdb_res_num?a.templates[t].pdb_res_num.slice(w,w+f.cols):null,resmap:A,keyseq:!1}),A&&(y[d.templates[t].struc_id]||(y[d.templates[t].struc_id]={}),y[d.templates[t].struc_id][d.templates[t].chain]||(y[d.templates[t].struc_id][d.templates[t].chain]=[]),y[d.templates[t].struc_id][d.templates[t].chain]=y[d.templates[t].struc_id][d.templates[t].chain].concat(A))),k+="</td></tr>"),z+=1}if(-1==chainMapping.alignments.indexOf(e.attr("id"))){if(a.modelLabel)if("model-template"==
a.type)for(kchn in u)chainMapping.chainMeta[a.struc_id]||(chainMapping.chainMeta[a.struc_id]={}),chainMapping.chainMeta[a.struc_id][kchn]||(chainMapping.chainMeta[a.struc_id][kchn]={display:a.modelLabel});else for(m=0;m<a.templates.length;m++)chainMapping.chainMeta[a.templates[m].struc_id]||(chainMapping.chainMeta[a.templates[m].struc_id]={}),chainMapping.chainMeta[a.templates[m].struc_id][a.templates[m].chain]||(chainMapping.chainMeta[a.templates[m].struc_id][a.templates[m].chain]={display:a.modelLabel});
chainMapping.alignments.push(e.attr("id"));for(kchn in u)if("model-template"==a.type)for(a.md5&&(chainMapping.targets[a.md5]||(chainMapping.targets[a.md5]={}),chainMapping.targets[a.md5][a.struc_id]||(chainMapping.targets[a.md5][a.struc_id]=[])),chainMapping.structures[a.struc_id]||(chainMapping.structures[a.struc_id]={}),chainMapping.structures[a.struc_id][kchn]||(chainMapping.structures[a.struc_id][kchn]=[]),m=0;m<u[kchn].length;m++)u[kchn][m]&&(n=!1,v=null,chainMapping.structures[a.struc_id][kchn][u[kchn][m][1]]?
(n=!0,v=chainMapping.structures[a.struc_id][kchn][u[kchn][m][1]]):v={trgno:u[kchn][m][1],trgname:u[kchn][m][0],chn:kchn,resno:u[kchn][m][1],resname:u[kchn][m][0]},3==u[kchn][m].length&&("qmean"in u[kchn][m][2].anno&&(v.qm=u[kchn][m][2].anno.qmean),"qmeanbrane"in u[kchn][m][2].anno&&(v.qmb=u[kchn][m][2].anno.qmeanbrane),"consistency"in u[kchn][m][2].anno&&(v.c=u[kchn][m][2].anno.consistency)),n||(a.md5&&(chainMapping.targets[a.md5][a.struc_id][u[kchn][m][1]]||(chainMapping.targets[a.md5][a.struc_id][u[kchn][m][1]]=
[]),chainMapping.targets[a.md5][a.struc_id][u[kchn][m][1]].push(v)),chainMapping.structures[a.struc_id][kchn][u[kchn][m][1]]=v));else for(m=0;m<u[kchn].length;m++)for(var C in y){chainMapping.targets[a.md5]||(chainMapping.targets[a.md5]={});chainMapping.targets[a.md5][C]||(chainMapping.targets[a.md5][C]=[]);chainMapping.structures[C]||(chainMapping.structures[C]={});for(var L in y[C])chainMapping.structures[C][L]||(chainMapping.structures[C][L]=[]),y[C][L][m]&&(n=!1,v=null,chainMapping.structures[C][L][y[C][L][m][1]]?
(n=!0,v=chainMapping.structures[C][L][y[C][L][m][1]]):(v={chn:L,resno:y[C][L][m][1],resname:y[C][L][m][0]},u[kchn][m]&&(v.trgno=u[kchn][m][1],v.trgname=u[kchn][m][0])),3==y[C][L][m].length&&("qmean"in y[C][L][m][2].anno&&(v.qm=y[C][L][m][2].anno.qmean),"qmeanbrane"in y[C][L][m][2].anno&&(v.qmb=y[C][L][m][2].anno.qmean),"consistency"in y[C][L][m][2].anno&&(v.c=y[C][L][m][2].anno.consistency)),n||(u[kchn][m]&&(chainMapping.targets[a.md5][C][u[kchn][m][1]]||(chainMapping.targets[a.md5][C][u[kchn][m][1]]=
[]),chainMapping.targets[a.md5][C][u[kchn][m][1]].push(v)),chainMapping.structures[C][L][y[C][L][m][1]]=v))}}(C=g.cookie("secStruct"))&&"none"==C||e.addClass("ss");$alignNameTbl.last().append(q);e.last().append(k);var N;!a.nowrap&&f.showResiduePosition&&e.find("tr").each(function(D,ba){N=0<D&&1==ba.getAttribute("seqno")?"padding-top:"+(Da+ya+10)+"px;":"";var ha=g(this).find("span[s]").last().attr("s");ha&&g(this).append('<td style="padding-left:8px; font-size:.8em; text-align:right; '+N+'">'+ha+"</td>")});
l||(chainMapping.defaultColourScheme?(g("#"+chainMapping.defaultColourScheme+"Button").prop("checked",!0),za(chainMapping.defaultColourScheme,e)):za(g.cookie("colourScheme"),e),d=null,f.firstDraw||ma(e))}}function P(e){return(e=e.match(/[^-]/g))?e.length:0}function Y(e){return e?' title="'+e+'" ':""}function Ka(e){for(var d="",f=0;f<e.length;f++)d+="<span>"+e.charAt(f)+"</span>";return d}function U(e,d){if(!e)return"";for(var f=d.pos,a=d.alIndex,l=d.seqres,k=null!=d.targetSeq,q=[],m=null,n=0;n<e.length;n++){var v=
e.charAt(n);if(v==Ba.gapChar)q.push('<span nm="true">-</span>'),d.resmap&&d.resmap.push(null);else{if(d.pdb_res_num){var u=d.pdb_res_num[n]-d.offset;var y=d.pdb_res_num[n-1],w=d.pdb_res_num[n],z=d.pdb_res_num[n+1];var t=d.pdb_res_num[n];y&&y!=w-1&&y!=w?(0<n&&"-"==e.charAt(n-1)&&(q[n-1]=q[n-1].substring(0,q[n-1].length-9)+' class="insert_r">-</span>'),q.push('<span s="'+t+'" r="'+v.toUpperCase()+'"'+(k&&d.targetSeq.charAt(n)!=v?' nm="true"':"")+' class="insert_l">'+v+"</span>")):z&&w!=z-1&&z!=w?(q.push('<span s="'+
t+'" r="'+v.toUpperCase()+'"'+(k&&d.targetSeq.charAt(n)!=v?' nm="true"':"")+' class="insert_r">'+v+"</span>"),n<e.length-2&&"-"==e.charAt(n+1)&&(q.push('<span nm="true" class="insert_l">-</span>'),n++)):q.push('<span s="'+t+'" r="'+v.toUpperCase()+'"'+(k&&d.targetSeq.charAt(n)!=v?' nm="true"':"")+">"+v+"</span>")}else d.up_res_num?(u=a+n,y=d.up_res_num[a+n-1],w=d.up_res_num[a+n],z=d.up_res_num[a+n+1],null==w&&(w=m+=1),null==z&&(y=w-1,z=w+1),t=w,q.push("<span "+(0<a+n&&y!=w-1?'class="insert_l"':"")+
(a+n<a+e.length-1&&w!=z-1?'class="insert_r"':"")+(' s="'+w+'" r="'+v.toUpperCase()+'"')+(k&&d.targetSeq.charAt(n)!=v?' nm="true"':"")+">"+v+"</span>"),m=w):l?(u=a+n,t=a+n+d.offset,q.push('<span s="'+t+'" r="'+v.toUpperCase()+'"'+(k&&d.targetSeq.charAt(n)!=v?' nm="true"':"")+">"+v+"</span>")):(u=f,t=f+d.offset,q.push('<span s="'+t+'" r="'+v.toUpperCase()+'"'+(k&&d.targetSeq.charAt(n)!=v?' nm="true"':"")+">"+v+"</span>"),f++);if(d.resmap){v=[v.toUpperCase(),t];if(d.annotation){v.push({anno:{}});for(var A in d.annotation)d.annotation[A]&&
d.annotation[A][u]&&(v[v.length-1].anno[A]=d.annotation[A][u]),d.keyseq&&"qmean"==A&&null==d.annotation.qmean[u]&&(q[q.length-1]='<span nores="true" '+q[q.length-1].substring(6))}d.resmap.push(v)}}}return q.join("")}function Z(e,d,f){e[f][d]?e[f][d]++:e[f][d]=1}function ua(e){for(var d,f,a=[],l=0;l<e[0].length;l++){a[l]={};for(var k=d=0;k<e.length;k++)f=e[k].charAt(l).toUpperCase(),f==Ba.gapChar?d++:(Z(a,f,l),"Q"!=f&&"E"!=f||Z(a,"QE",l),"E"==f||"D"==f?Z(a,"ED",l):-1<"/[WLVIMAFCYHP]/".indexOf(f)?Z(a,
"WLVIMAFCYHP",l):"K"==f||"R"==f?Z(a,"KR",l):("T"==f||"S"==f)&&Z(a,"TS",l));a[l].gapCount=d;f={};for(var q in a[l])f[q+"_nogap"]=(a[l][q]/e.length).toFixed(2),a[l][q]=(a[l][q]/(e.length-d)).toFixed(2);for(q in f)a[l][q]=f[q]}return a}function za(e,d){var f=d.find("span");if(0!=f.length){g.each(f,function(B,H){H.style.backgroundColor&&(H.style.backgroundColor="")});d.data("features")||d.removeData("features");null==e&&(e="rainbow");if(d.data("features")){var a={};for(k in d.data("features"))a.$jscomp$loop$prop$struc_id$16$80=
k,a.$jscomp$loop$prop$seqno$17$78=0,a.$jscomp$loop$prop$$rows$79=d.find("tr[struc_id]"),a.$jscomp$loop$prop$$rows$79.filter("[struc_id="+a.$jscomp$loop$prop$struc_id$16$80+"]").each(function(B){return function(H,M){if(B.$jscomp$loop$prop$seqno$17$78>parseInt(M.getAttribute("seqno")))return!1;B.$jscomp$loop$prop$seqno$17$78=parseInt(M.getAttribute("seqno"));var E=M.getAttribute("chain");E||(E=M.getAttribute("keyseqchain"));for(var Q=B.$jscomp$loop$prop$$rows$79.filter("tr[seqno="+B.$jscomp$loop$prop$seqno$17$78+
"]").find(" span[s]"),V=0;V<d.data("features")[B.$jscomp$loop$prop$struc_id$16$80].length;V++){var O=d.data("features")[B.$jscomp$loop$prop$struc_id$16$80][V],ia=O.rgb.split(",").map(Number);if(O.frmChn!=O.toChn)console.error("THIS IS AN ERROR "+O);else if(-1!=O.frmChn.indexOf(E))for(var aa=O.resStart;aa<O.resEnd+1;aa++)chainMapping.structures[B.$jscomp$loop$prop$struc_id$16$80][E][aa]&&(chainMapping.structures[B.$jscomp$loop$prop$struc_id$16$80][E][aa].rgb=ia)}Q.each(function(Wa,Ha){var Ia=parseInt(Ha.getAttribute("s"));
chainMapping.structures[B.$jscomp$loop$prop$struc_id$16$80][E][Ia]&&(Ha.style.backgroundColor="rgba("+chainMapping.structures[B.$jscomp$loop$prop$struc_id$16$80][E][Ia].rgb+",.6)")})}}(a)),a={$jscomp$loop$prop$seqno$17$78:a.$jscomp$loop$prop$seqno$17$78,$jscomp$loop$prop$$rows$79:a.$jscomp$loop$prop$$rows$79,$jscomp$loop$prop$struc_id$16$80:a.$jscomp$loop$prop$struc_id$16$80}}else if("chain"==e||"uniqueChain"==e||"template"==e){var l=null;if("undefined"!=typeof globalTemplateData){if(l=globalTemplateData,
!globalTemplateData.chainColoursAssigned){for(a=0;a<globalTemplateData.length;a++){var k=globalTemplateData[a];k.chainColours={chain:[],unique:[],template:ja[a%ja.length]};for(var q=k.chain_name?"chain_name":"chain",m=0;m<k[q].length;m++){k.chainColours.unique[1<k[q][m].length?k[q][m].join(""):k[q][m]]=ja[Ea];Ea++;Ea%=12;for(var n=0;n<k[q][m].length;n++)k.chainColours.chain[k[q][m][n]]=ja[va],va++,va%=ja.length}}globalTemplateData.chainColoursAssigned=!0}}else l=d.data("templateData").templates,g(".alignTbl").each(function(){var B=
g(this).data("templateData");if(B&&B.templates&&!B.chainColoursAssigned){for(var H=0;H<B.templates.length;H++)if(B.templates[H].chainColours={chain:[],unique:[]},"model-template"==B.type)for(var M=0;M<B.keyseq_chain_name.length;M++)B.templates[H].chainColours.chain[B.keyseq_chain_name[M]]=ja[va],B.templates[H].chainColours.unique[B.keyseq_chain_name[M]]=ja[Ea],va++,va%=ja.length;else B.templates[H].chainColours.chain[B.templates[H].chain]=ja[va],B.templates[H].chainColours.unique[B.templates[H].chain]=
ja[Ea],va++,va%=ja.length;Ea++;Ea%=ja.length;B.chainColoursAssigned=!0}});l?g.each(d.find("tr[struc_id]"),function(B,H){var M=H.getAttribute("struc_id"),E=H.getAttribute("keyseqchain");E||(E=H.getAttribute("chain"));if(!E)return!1;for(var Q=g(this).find("span[s]"),V=null,O={},ia=0;ia<l.length;O={$jscomp$loop$prop$rgb$23$82:O.$jscomp$loop$prop$rgb$23$82},ia++)if(l[ia].struc_id==M){V=l[ia];O.$jscomp$loop$prop$rgb$23$82=void 0;if("chain"==e)O.$jscomp$loop$prop$rgb$23$82=V.chainColours.chain[E];else if("template"==
e)O.$jscomp$loop$prop$rgb$23$82=V.chainColours.template;else for(chns in V.chainColours.unique)if(-1<chns.indexOf(E)){O.$jscomp$loop$prop$rgb$23$82=V.chainColours.unique[chns];break}O.$jscomp$loop$prop$rgb$23$82&&Q.each(function(aa){return function(Wa,Ha){Ha.style.backgroundColor="rgb("+aa.$jscomp$loop$prop$rgb$23$82+",.6)";if(M){var Ia=parseInt(Ha.getAttribute("s"));chainMapping.structures[M]&&chainMapping.structures[M][E]&&chainMapping.structures[M][E][Ia]&&(chainMapping.structures[M][E][Ia].rgb=
aa.$jscomp$loop$prop$rgb$23$82)}}}(O))}}):d.find("span").each(function(B,H){H.style.backgroundColor="rgba("+ja[g(".alignTbl").index(d)%ja.length]+",.6)"})}else if("rainbow"==e){var v=!1,u=0,y=d.find("tr");y.each(function(B,H){var M=H.getAttribute("struc_id"),E=H.getAttribute("chain");E||(E=H.getAttribute("keyseqchain"));0==B&&(v="model-template"==H.getAttribute("keyseqtype"));var Q=parseInt(H.getAttribute("seqno"));if(Q<=u)return!1;u=Q;if(!v||null!=H.getAttribute("keyseqtype"))for($span=y.filter("[seqno="+
u+"]").find("span[s]:not([nores])"),Q=0;Q<$span.length;Q++){var V=$span[Q].getAttribute("s");if(null!=V){var O=Q/$span.length*(1.5*Math.PI-Math.PI/2)+Math.PI/2;O=[Math.round(127.5*(Math.sin(O+Math.PI)+1)),Math.round(255*Math.sin(O-Math.PI/2)),Math.round(127.5*(Math.sin(O)+1))];$span[Q].style.backgroundColor="rgba("+O+",.6)";M&&chainMapping.structures[M]&&chainMapping.structures[M][E]&&(V=parseInt(V),chainMapping.structures[M][E][V]&&(chainMapping.structures[M][E][V].rgb=O))}}})}else if("qmean_local"==
e){var w="qm";"undefined"!==typeof qmeanbraneActive&&qmeanbraneActive&&(w="qmb");d.find("tr[struc_id]").each(function(){var B=g(this).attr("struc_id"),H=g(this).attr("chain");H||(H=g(this).attr("keyseqchain"));var M=g(this).find("span[s]"),E=!0,Q=!1;for(chn in chainMapping.structures[B]){for(res in chainMapping.structures[B][chn])if(chainMapping.structures[B][chn][res])if(chainMapping.structures[B][chn][res][w]){if(valExists=!0,1<chainMapping.structures[B][chn][res][w]){E=!1;break}}else chainMapping.structures[B][chn][res].bfactor&&
(Q=!0);if(!E)break}if(Q)return ka(d,"bfactor_range",g(this)),!0;g.each(M,function(V,O){var ia=parseInt(O.getAttribute("s"));if(!chainMapping.structures[B][H][ia])return!0;var aa=chainMapping.structures[B][H][ia][w];if(null==aa)return!0;E||(aa/=100);aa=qmeanLocalColour(aa,.6);O.style.backgroundColor=aa;aa=aa.substring(5).split(",").slice(0,3).map(Number);chainMapping.structures[B][H][ia].rgb=aa})})}else if("confClass"==e)d.find("tr[struc_id]").each(function(){var B=g(this).attr("struc_id"),H=g(this).attr("chain");
H||(H=g(this).attr("keyseqchain"));var M=g(this).find("span[s]"),E=!0,Q=!1;for(chn in chainMapping.structures[B]){for(res in chainMapping.structures[B][chn])if(chainMapping.structures[B][chn][res])if(chainMapping.structures[B][chn][res].qm){if(1<chainMapping.structures[B][chn][res].qm){E=!1;break}}else chainMapping.structures[B][chn][res].bfactor&&(Q=!0);if(!E)break}if(Q)return ka(d,"bfactor_range",g(this)),!0;g.each(M,function(V,O){var ia=parseInt(O.getAttribute("s"));if(!chainMapping.structures[B][H][ia])return!0;
var aa=chainMapping.structures[B][H][ia].qm;if(!aa)return!0;E&&(aa*=100);rgb=90<aa?[0,83,214]:70<aa?[101,203,243]:50<aa?[255,219,19]:[255,125,69];O.style.backgroundColor="rgba("+rgb+",.6)";chainMapping.structures[B][H][ia].rgb=rgb})});else if(-1<e.indexOf("consistency")){var z=0,t=1;"consistency"!=e&&(z=999,t=-99,d.find("tr[struc_id]").each(function(){var B=g(this).attr("struc_id"),H=g(this).attr("chain");H||(H=g(this).attr("keyseqchain"));if(!H)return!0;for(var M=0;M<chainMapping.structures[B][H].length;M++)chainMapping.structures[B][H][M]&&
chainMapping.structures[B][H][M].c&&(z=Math.min(z,chainMapping.structures[B][H][M].c),t=Math.max(t,chainMapping.structures[B][H][M].c))}));d.find("tr[struc_id]").each(function(){var B=g(this).attr("struc_id"),H=g(this).attr("chain");H||(H=g(this).attr("keyseqchain"));if(!H)return!0;for(var M=g(this).find("span[s]").toArray(),E=0;E<M.length;E++){var Q=[127,195,45],V=parseInt(M[E].getAttribute("s")),O=chainMapping.structures[B][H][V].c;O&&(t!=z&&(O=(parseFloat(O)-z)/(t-z),.5>O?(Q[0]=Math.round(255*
(1-O)),Q[1]=Math.round(160*O),Q[2]=Math.round(90*O)):(Q[0]=127,Q[1]=Math.round(20+175*O),Q[2]=45)),M[E].style.backgroundColor="rgba("+Q+",0.6)",B&&(chainMapping.structures[B][H][V].rgb=Q))}})}else if("clustal"==e){var A=d.data("clustalColours");A||(a=X(d.data("templateData"),d),A=ua(a.concat(a.target)),d.data("clustalColours",A));var I,K=0,G;d.find("tr").each(function(){if(parseInt(g(this).attr("seqno"))<K)return!1;var B=g(this).attr("struc_id"),H=g(this).attr("chain");H||(H=g(this).attr("keyseqchain"));
K=parseInt(g(this).attr("seqno"));var M=d.find("tr[seqno="+K+"] span");g.each(M,function(E,Q){if(null!=A[E]&&Q.hasAttribute("r")&&(I=Q.getAttribute("r"),"P"==I?G=Xa:"G"==I?G=Ya:"H"!=I&&"Y"!=I||!(.6<=A[E].WLVIMAFCYHP||.5<A[E].P)?"D"==I&&(.5<=A[E].N||.5<=A[E].ED&&.5<=!A[E].QE)?G=Qa:"E"==I&&(.5<=A[E].ED||.5<=A[E].QE)?G=Qa:"C"==I&&.85<=A[E].C?G=Za:"N"==I&&(.5<=A[E].N||.85<=A[E].D)?G=La:"Q"==I&&(.6<=A[E].KR||.5<=A[E].QE)?G=La:"S"==I&&(.5<=A[E].TS||.8<=A[E].WLVIMAFCYHP)?G=La:"T"==I&&(.5<=A[E].TS||.6<=A[E].WLVIMAFCYHP)?
G=La:"R"!=I&&"K"!=I||!(.6<=A[E].KR||.85<=A[E].Q)?-1<"/[WLVIMAF]/".indexOf(I)&&(.5<=A[E].P||.6<=A[E].WLVIMAFCYHP)?G=Ra:"A"!=I&&"C"!=I||!(.5<=A[E].P||.6<=A[E].WLVIMAFCYHP||.85<=A[E].S)||(G=Ra):G=$a:G=ab,G&&(Q.style.backgroundColor="rgb("+G+",.5)",B&&chainMapping.structures[B]&&chainMapping.structures[B][H]))){var V=parseInt(Q.getAttribute("s"));chainMapping.structures[B][H][V]&&(chainMapping.structures[B][H][V].rgb=G)}})})}else if("secstruc"==e){a=g.cookie("secStruct");null==a&&(a="dssp");k=d.data("templateData");
q=d.find("tr");var C;if(k.keyseq_annotation)for(m=0;m<k.keyseq_chain_name.length;m++){var L=k.struc_id;n=k.keyseq_chain_name[m];if(k.keyseq_annotation[n]&&k.keyseq_annotation[n][a])for(var N=Na(k.keyseq_annotation[n],a).replace(/[GI]/g,"H").replace(/B/g,"E"),D=0;D<N.length;D++)chainMapping.structures[L][n][D+1]&&(chainMapping.structures[L][n][D+1].ss=N[D]);else if(chainMapping.structures[L])for(N=0;N<chainMapping.structures[L][n].length;N++)chainMapping.structures[L][n][N]&&(chainMapping.structures[L][n][N].ss=
null)}else if(k.templates)for(m=0;m<k.templates.length;m++)if(n=k.templates[m],n.annotation&&n.annotation[a])if(N=Na(n.annotation,a).replace(/[GI]/g,"H").replace(/B/g,"E"),chainMapping.structures[n.struc_id])for(D=0;D<N.length;D++)chainMapping.structures[n.struc_id][n.chain]&&chainMapping.structures[n.struc_id][n.chain][D+1]&&(chainMapping.structures[n.struc_id][n.chain][D+1].ss=N[D]);else console.warn("no chain mapping found for "+n.struc_id+" "+n.chain);else if(n.struc_id&&"none"!=a){N=!1;for(D=
0;!N&&D<chainMapping.structures[n.struc_id][n.chain].length;D++)chainMapping.structures[n.struc_id][n.chain][D]&&chainMapping.structures[n.struc_id][n.chain][D].ss&&(N=!0);N||fetchSecStruc(n.struc_id)}m=0;n={};for(N=0;N<q.length;n={$jscomp$loop$prop$annot$48$84:n.$jscomp$loop$prop$annot$48$84,$jscomp$loop$prop$chn$47$85:n.$jscomp$loop$prop$chn$47$85},N++){D=q.eq(N);if(parseInt(D.attr("seqno"))<m)break;m=parseInt(D.attr("seqno"));n.$jscomp$loop$prop$chn$47$85=D.attr("chain");n.$jscomp$loop$prop$chn$47$85||
(n.$jscomp$loop$prop$chn$47$85=D.attr("keyseqchain"));L=D.attr("struc_id");n.$jscomp$loop$prop$annot$48$84=null;if(!L){if("model-template"==k.type)for(D=0;D<k.templates.length;D++)if(k.templates[D].chain==n.$jscomp$loop$prop$chn$47$85){k.templates[D].annotation&&k.templates[D].annotation[a]&&(n.$jscomp$loop$prop$annot$48$84=Na(k.templates[D].annotation,a),n.$jscomp$loop$prop$annot$48$84=n.$jscomp$loop$prop$annot$48$84.replace(/[GI]/g,"H").replace(/B/g,"E"));break}if(!n.$jscomp$loop$prop$annot$48$84)continue}$row=
q.filter('[seqno="'+m+'"]');D=$row.find("span[s]").toArray();g.each(D,function(B){return function(H,M){var E=null;C=parseInt(M.getAttribute("s"));B.$jscomp$loop$prop$annot$48$84?"E"==B.$jscomp$loop$prop$annot$48$84[C-1]?E=[51,204,51]:"H"==B.$jscomp$loop$prop$annot$48$84[C-1]&&(E=[153,153,230]):chainMapping.structures[L][B.$jscomp$loop$prop$chn$47$85][C]&&("E"==chainMapping.structures[L][B.$jscomp$loop$prop$chn$47$85][C].ss?E=[51,204,51]:"H"==chainMapping.structures[L][B.$jscomp$loop$prop$chn$47$85][C].ss&&
(E=[153,153,230]),chainMapping.structures[L][B.$jscomp$loop$prop$chn$47$85][C].rgb=E);M.style.backgroundColor="rgba("+E+",.6)"}}(n))}}else if(-1<["hydrophobic","size","charged","cysteine"].indexOf(e)||xa[e])d.find("tr").each(function(){var B=g(this).attr("struc_id"),H=g(this).attr("chain");H||(H=g(this).attr("keyseqchain"));var M=g(this).find("span");g.each(M,function(E,Q){if((res=Q.getAttribute("r"))&&xa[res]){var V=la(e,res);if(!V)return!0;Q.style.backgroundColor="rgba("+V+",.6)";if(B&&chainMapping.structures[B]&&
chainMapping.structures[B][H]){var O=parseInt(Q.getAttribute("s"));chainMapping.structures[B][H][O]&&(chainMapping.structures[B][H][O].rgb=V)}}})});else if("soa"==e)ka(d,"soa");else if(-1<e.indexOf("bfactor"))ka(d,e);else if("entropy"==e)ka(d,"entropy");else if("indels"==e&&"model-template"==d.data("templateData").type&&d.data("templateData").templates[0].tpl_seq){a=d.data("templateData");var ba=a.struc_id;k=99999999;q=0;m=[];n=[];for(N=0;N<a.templates.length;N++)if(a.templates[N].struc_id==ba)for(trgOffset=
a.templates[N].trg_offset?a.templates[N].trg_offset-1:0,a.templates[N].residue_from?(k=Math.min(k,a.templates[N].residue_from),q=Math.max(q,a.templates[N].residue_to)):(k=0,q=99999999999),D=0;D<a.templates[N].trg_seq.length;D++)"-"!=a.templates[N].trg_seq.charAt(D)&&(n[D]="X"),"-"!=a.templates[N].tpl_seq.charAt(D)&&(m[D]="X");N=null;D=1+trgOffset;for(var ha=[],wa=[],na=0;na<a.templates[0].trg_seq.length;na++){if(!m[na])for(var Aa=0;-1==ha.indexOf(D)&&Aa<a.keyseq_chain_name.length;Aa++)D>=k&&D<=q&&
ha.push(D);if(n[na])N=D,D++;else if(null!=N)for(Aa=0;-1==wa.indexOf(D)&&Aa<a.keyseq_chain_name.length;Aa++)D>=k&&D<=q&&wa.push(D),D-1>=k&&D<=q&&wa.push(D-1)}k={};for(q=0;q<a.keyseq_chain_name.length;k={$jscomp$loop$prop$chain$59$87:k.$jscomp$loop$prop$chain$59$87},q++)k.$jscomp$loop$prop$chain$59$87=a.keyseq_chain_name[q],m=d.find("tr[keyseqchain="+k.$jscomp$loop$prop$chain$59$87+"]"),g.each(m.find("span[s]:not([nores])"),function(B){return function(H,M){var E=parseInt(M.getAttribute("s"));if(-1<
ha.indexOf(E))rgb=[80,214,80];else if(-1<wa.indexOf(E))rgb=[100,100,255];else return!0;M.style.backgroundColor="rgba("+rgb+",.6)";chainMapping.structures[ba][B.$jscomp$loop$prop$chain$59$87][E].rgb=rgb}}(k))}g.cookie("targetMismatch")?"fade"==g.cookie("targetMismatch")?f.filter("[nm]").addClass("targetMismatch"):"enhance"==g.cookie("targetMismatch")&&(f.not("[nm]").addClass("targetMismatch"),f.not("[s]").addClass("targetMismatch")):f.filter("[nm]").addClass("targetMismatch");Fa&&(fa&&d.find("tr[seqno="+
fa.seqno+"]").find("span").eq(fa.seqidx).addClass("cursor"),d.data("startEditRegion")&&d.data("endEditRegion")&&(f=d.data("startEditRegion"),a=d.data("endEditRegion"),q=f.closest("tr"),k=q.attr("seqno"),q=q.siblings("[seqno="+k+"]").addBack().find("span"),k=d.find("tr[seqno="+k+"]").find("span"),k=k.slice(q.index(f),q.index(a)+1).addClass("shadowCursor"),d.data("startEditRegion",k.first()),d.data("endEditRegion",k.last())))}}function la(e,d){if("hydrophobic"==e){var f=xa[d][e];return null==f?void 0:
[Math.round(255*f),0,255-Math.round(255*f)]}if("size"==e)return f=xa[d][e],null==f?void 0:[Math.round(255*f),255-Math.round(255*f),0];if("charged"==e){if(-1<xa.positive.indexOf(d))return[100,100,255];if(-1<xa.negative.indexOf(d))return[255,100,100]}else return"cysteine"==e?"C"==d?[202,168,14]:null:-1<xa[e].indexOf(d)?[20,80,250]:null}function ka(e,d,f){if(!e.data("options").textOnly){var a=!1,l=null,k=null,q="bfactor_range"==d;q&&(d="bfactor");(f?f:e.find("tr[struc_id]")).each(function(){l=g(this).attr("struc_id");
k=g(this).attr("qname");var m=g(this).attr("chain");m||(m=g(this).attr("keyseqchain"));if(!m)return!0;var n=g(this).find("span[s]");g.each(n,function(v,u){var y=parseInt(u.getAttribute("s"));if(!(chainMapping.structures[l]&&chainMapping.structures[l][m]&&chainMapping.structures[l][m][y]&&d in chainMapping.structures[l][m][y]))return!0;a=!0;var w=chainMapping.structures[l][m][y][d],z=[0,200,0];"entropy"==d?z=1.9>w?[Math.floor(w/1.9*256),Math.floor(w/1.9*256),255]:[255,256-Math.floor((w-1.9)/1.9*256),
256-Math.floor((w-1.9)/1.9*256)]:"soa"==d?(w=Math.max(0,Math.min(1,.01*w)),z=[Math.floor(255*(1-w)),0,255-Math.floor(255*(1-w))]):"bfactor"==d&&(q?(w=chainMapping.annotations.map(function(t){return t.key}).indexOf("bfactor_range"),chainMapping.annotations[w].rangeColours[l]&&chainMapping.annotations[w].rangeColours[l][m]&&(z=chainMapping.annotations[w].rangeColours[l][m][y])):z=10>=w?[0,0,255]:10<w&&15>=w?[115,115,255]:15<w&&20>=w?[170,170,255]:20<w&&25>=w?[215,215,255]:25<w&&30>=w?[255,215,215]:
30<w&&35>=w?[255,170,170]:35<w&&40>=w?[255,115,115]:[255,0,0]);u.style.backgroundColor="rgba("+z+",.6)";chainMapping.structures[l][m][y].rgb=z})});a||(!k||"soa"!=d&&"entropy"!=d||"undefined"===typeof SCORE_URL?"bfactor"==d&&fetchBFactors(l,"bfactor")&&ka(e,d+(q?"_range":"")):g.getJSON(SCORE_URL.replace("xxxx.0",k.match(/\w{4}\.\d+/)[0])+d,function(m,n){if(m.error)console.error("Could not fetch "+d+" values");else{for(chn in m)for(var v=0;v<m[chn].values.length;v++)null!=m[chn].values[v]&&chainMapping.structures[l]&&
chainMapping.structures[l][chn]&&chainMapping.structures[l][chn][v+m[chn].offset+1]&&(chainMapping.structures[l][chn][v+m[chn].offset+1][d]=m[chn].values[v]);za(d,e);ca()}}))}}function ca(e){e&&e.singleResidue||("function"===typeof colourRama&&colourRama(),"function"===typeof colourModelBars&&colourModelBars());"undefined"!==typeof currentWin&&(0<g("#pv:visible",currentWin.document).length&&oa(),0<g("#ngl:visible",currentWin.document).length&&(e&&e.singleResidue?pa(e.singleResidue):Ma(e)))}function pa(e){for(schemeId in NGL.ColormakerRegistry.userSchemes)-1<
schemeId.indexOf("singleres")&&(NGL.ColormakerRegistry.removeScheme(schemeId),ngl_stage.eachRepresentation(function(f){if(f.repr.colorScheme==schemeId)for(schemeId2 in NGL.ColormakerRegistry.userSchemes)if(schemeId2.endsWith(f.name)){f.setColor(schemeId2);break}}));if(e){var d=e.struc_id;getNGLComponentByName(d)&&ngl_stage.eachRepresentation(function(f){if(f.name==d&&chainMapping.structures[d]){var a=NGL.ColormakerRegistry.addScheme(function(l){for(chn in chainMapping.structures[d])" "==chn&&g("#ngl_status").html("NGL cannot colour or select chains named whitespace!");
this.atomColor=function(k){return ngl_picked_atom&&k.structure.name==ngl_picked_atom.structure.name&&k.index==ngl_picked_atom.index?16711680:chainMapping.structures[d][k.chainname]&&chainMapping.structures[d][k.chainname][k.resno]&&chainMapping.structures[d][k.chainname][k.resno].rgb?chainMapping.structures[d][k.chainname][k.resno].rgb[0]<<16|chainMapping.structures[d][k.chainname][k.resno].rgb[1]<<8|chainMapping.structures[d][k.chainname][k.resno].rgb[2]:16777215}},"singleres");f.setColor(a)}})}}
function Ma(e){var d=[];ngl_stage.eachRepresentation(function(l){d.push(l.name)});e=e&&e.strucId?e.strucId:null;var f={},a;for(a in ngl_stage.compList){if(void 0!==ngl_stage.compList[a].structure&&(f.$jscomp$loop$prop$strucId$89=ngl_stage.compList[a].name,!e||f.$jscomp$loop$prop$strucId$89==e)){for(schemeId in NGL.ColormakerRegistry.userSchemes)-1<schemeId.indexOf(f.$jscomp$loop$prop$strucId$89)&&-1==schemeId.indexOf("membrane")&&NGL.ColormakerRegistry.removeScheme(schemeId);ngl_stage.eachRepresentation(function(l){return function(k){if((k.name==
l.$jscomp$loop$prop$strucId$89||k.name.endsWith(".highlight")||"drug.surroundings"==k.name)&&chainMapping.structures[l.$jscomp$loop$prop$strucId$89]){var q=NGL.ColormakerRegistry.addScheme(function(m){for(chn in chainMapping.structures[l.$jscomp$loop$prop$strucId$89])" "==chn&&g("#ngl_status").html("NGL cannot colour or select chains named whitespace!");this.atomColor=function(n){return chainMapping.structures[l.$jscomp$loop$prop$strucId$89][n.chainname]&&chainMapping.structures[l.$jscomp$loop$prop$strucId$89][n.chainname][n.resno]&&
chainMapping.structures[l.$jscomp$loop$prop$strucId$89][n.chainname][n.resno].rgb?chainMapping.structures[l.$jscomp$loop$prop$strucId$89][n.chainname][n.resno].rgb[0]<<16|chainMapping.structures[l.$jscomp$loop$prop$strucId$89][n.chainname][n.resno].rgb[1]<<8|chainMapping.structures[l.$jscomp$loop$prop$strucId$89][n.chainname][n.resno].rgb[2]:16777215}},l.$jscomp$loop$prop$strucId$89);k.setColor(q)}}}(f))}f={$jscomp$loop$prop$strucId$89:f.$jscomp$loop$prop$strucId$89}}}function oa(){var e=[];pv_viewer.forEach(function(a){e.push(a.name())});
if(0!=e.length){var d={},f;for(f in chainMapping.structures)d.$jscomp$loop$prop$strucId$91=f,-1<e.indexOf(d.$jscomp$loop$prop$strucId$91)&&pv_viewer.get(d.$jscomp$loop$prop$strucId$91)&&pv_viewer.get(d.$jscomp$loop$prop$strucId$91).colorBy(new pv.color.ColorOp(function(a){return function(l,k,q){l=l.residue();chainMapping.structures[a.$jscomp$loop$prop$strucId$91][l.chain().name()]&&chainMapping.structures[a.$jscomp$loop$prop$strucId$91][l.chain().name()][l.num()]&&chainMapping.structures[a.$jscomp$loop$prop$strucId$91][l.chain().name()][l.num()].rgb?
(k[q]=chainMapping.structures[a.$jscomp$loop$prop$strucId$91][l.chain().name()][l.num()].rgb[0]/255,k[q+1]=chainMapping.structures[a.$jscomp$loop$prop$strucId$91][l.chain().name()][l.num()].rgb[1]/255,k[q+2]=chainMapping.structures[a.$jscomp$loop$prop$strucId$91][l.chain().name()][l.num()].rgb[2]/255):(k[q]=.9,k[q+1]=.9,k[q+2]=.9);k[q+3]=1}}(d))),d={$jscomp$loop$prop$strucId$91:d.$jscomp$loop$prop$strucId$91};pv_viewer.requestRedraw()}}function ma(e){var d=g.cookie("secStruct");null==d&&(d="dssp");
var f=e.attr("id")+"_features";g("#"+f).html("");if(0==g("#"+f).length||d&&"none"==d)e.removeClass("ss"),F(e).removeClass("ss");else{e.addClass("ss");F(e).addClass("ss");var a=e.position().top,l=e.find("td").first().width(),k=e.find("span")[0],q=k.getBoundingClientRect().width;k=k.getBoundingClientRect().height;var m=e.position().left;if(!(1>l)){p=Raphael(f,l,e.height());g("#"+f).css("top",e.position().top);var n=e.data("templateData");if(n){e=e.find("tr:visible");if(n.keyseq_annotation)for(f=0;f<
n.keyseq_chain_name.length;f++){var v=n.keyseq_chain_name[f];if(n.keyseq_annotation[v]){var u=n.templates[0].trg_offset?n.templates[0].trg_offset:1;n.keyseq_annotation[v][d]&&Sa(p,Ta(n.keyseq_annotation[v],d,u),e.filter('[keyseqchain="'+v+'"]'),e.filter('[keyseqchain="'+v+'"]').find("span[s]").toArray(),a,m,l,q,k);n.charts&&function(A,I,K){setTimeout(function(){bb(A,n.keyseq_annotation[I],d,u,K,a,l,q,5E3>n.pageResidueCount)},0)}(p,v,e.filter('[keyseqchain="'+v+'"]'))}}f=0;for(v=1;v<e.length;v++){var y=
e.eq(v);if(parseInt(y.attr("seqno"))<f)break;f=parseInt(y.attr("seqno"));if(!y.attr("keyseqtype")){var w=y.attr("tpl_id");y=y.attr("chain");$row=w?e.filter('[tpl_id="'+w+'"]'):e.filter('[chain="'+y+'"]');for(var z=$row.find("span[s]").toArray(),t=0;t<n.templates.length;t++)(w?n.templates[t].id==w:n.templates[t].chain==y)&&n.templates[t].annotation&&n.templates[t].annotation[d]&&Sa(p,Ta(n.templates[t].annotation,d),$row,z,a,m,l,q,k)}}}}}}function Na(e,d){var f=e[d];"string"==typeof f&&(e[d+"_string"]=
f.replace(/[GI]/g,"H").replace(/B/g,"E"));return e[d+"_string"]}function Ta(e,d,f){f||(f=1);var a=e[d];if("string"==typeof a){e[d+"_string"]=e[d];a=e[d].replace(/[GI]/g,"H").replace(/B/g,"E");for(var l=null,k=0;k<a.length;k++)if("H"==a[k]||"E"==a[k])res_index=k+f,null==l?l=[[res_index,res_index,a[k]]]:l[l.length-1][1]==res_index-1&&l[l.length-1][2]==a[k]?l[l.length-1][1]=res_index:l.push([res_index,res_index,a[k]]);e[d]=l}return e[d]}function bb(e,d,f,a,l,k,q,m,n){var v=null!=d.qmean;a||(a=1);var u=
e.set(),y=e.set(),w=e.set();l.each(function(z,t){span=g(t).find("span").toArray();if(0!=span.length){var A=t.getAttribute("struc_id"),I=t.getAttribute("chain");I||(I=t.getAttribute("keyseqchain"));var K=Da-ya,G=g(t).position().top-k+g(span[0]).position().top-ya,C=G,L=t.getBoundingClientRect().left,N=span[span.length-1].getBoundingClientRect().right-L;if(v){e.path("M0,"+C+"L"+q+","+C+"L"+q+","+(C-K)+"L0,"+(C-K)).attr({"stroke-width":.4,stroke:"#888"});for(var D=3;10>D;D++){var ba=C-1/.7*K*(D/10-.3);
var ha=e.path("M0,"+ba+"L"+q+","+ba);5==D?ha.attr({"stroke-width":.7,opacity:.8,stroke:"#888","stroke-dasharray":"-"}):u.push(ha)}}ha="";var wa;for(D=0;D<span.length;D++)if(C=span[D],C.hasAttribute("s")){ba=parseInt(C.getAttribute("s"));var na=ba-a;ha=d[f+"_string"]&&d[f+"_string"][na]?ha+d[f+"_string"][na]:ha+"-";x=C.getBoundingClientRect().left-L;C=G;C-=2;if(v)if(na=Math.max(.3,chainMapping.structures[A][I][ba].qm),ba=C-1/.7*(K-2)*(na-.3),n){var Aa="245,80,0";.5<na&&(z=Math.round(490*(1-na)),b=
Math.round(255*na),Aa=z+",80,"+b);s=e.path("M"+x+","+C+"L"+x+","+ba+"L"+(x+m)+","+ba+"L"+(x+m)+","+C);s.attr({fill:"rgba("+Aa+",.6)",stroke:"#333"})}else wa+="M"+x+" "+C,wa+="L"+x+" "+ba,wa+="L"+(x+m)+" "+ba,wa+="L"+(x+m)+" "+C}else ha+="-";txt=e.text(2,G+ya/2,ha);y.push(txt);txt.node.setAttribute("textLength",N-4+"px");txt.node.firstChild.setAttribute("textLength",N-4+"px");w.push(e.path(wa))}});y.attr({"text-anchor":"start","font-family":"consolas"});w.attr({stroke:"#555"});u.attr({"stroke-width":.9,
stroke:"#888",opacity:.6,"stroke-dasharray":". "})}function Sa(e,d,f,a,l,k,q,m,n){if(null!=d){f.attr("seqno");for(var v=0,u=a.length,y=0;y<d.length;y++)if("E"==d[y][2]||"H"==d[y][2]){var w=null,z=null,t;for(t=d[y][0];t<=d[y][1];t++)if(!(a[v].getAttribute("s")>t)){for(s=v;s<u;s++)if(a[s].getAttribute("s")==t){v=s;w=g(a[s]);break}if(w)break}for(t=d[y][1];t>=d[y][0];t--){for(s=v;s<u;s++)if(a[s].getAttribute("s")==t){v=s;z=g(a[s]);break}if(z)break}if(null==w||null==z)v=0;else for(thisRow=w.closest("tr"),
startRowIdx=f.index(thisRow),endRowIdx=f.index(z.closest("tr")),w=w.position(),startResLeft=w.left-k,spanTop=w.top,endResLeft=z.position().left-k,rightLimit=thisRow.width()-m-m,z=startRowIdx;z<endRowIdx+1;z++)if(z>startRowIdx&&(thisRow=f.eq(z),spanTop=thisRow.find("span").first().position().top),t=thisRow.position().top+spanTop-l,"E"==d[y][2]){w=e;var A=startResLeft-(z-startRowIdx)*q,I=endResLeft+(endRowIdx-z)*q,K=m,G=n,C=rightLimit;t+=1;G-=2;padding=2;A=Math.max(-K,Math.round(A));I=Math.min(C,Math.round(I+
K));s=w.path("M"+A+","+(t-padding)+"L"+(I-6)+","+(1.5+t)+"L"+(I-6)+","+(t-padding)+"L"+(I+padding)+","+(G/2+t)+"L"+(I-6)+","+(G+t+padding)+"L"+(I-6)+","+(G-1.5+t)+"L"+A+","+(G+t+padding)+"L"+A+","+(t-padding));s.attr({"stroke-width":.7,fill:"#DDD","fill-opacity":.3,stroke:"#226","stroke-dasharray":"5 2"})}else w=e,A=startResLeft-(z-startRowIdx)*q,I=endResLeft+(endRowIdx-z)*q,K=m,G=n,C=rightLimit,padding=2,A=Math.max(-K,Math.round(A)),I=Math.min(C,Math.round(I+K)),h=w.rect(A,t+2-padding,I-A,G-4+2*
padding,4),h.attr({"stroke-width":.7,fill:"#DDD","fill-opacity":.3,stroke:"#226"})}}}function Ua(){var e="";"Multi FASTA"==g("#alignmentFormatSelect").val()?g(".alignTbl:visible").each(function(){e+=Oa(g(this).attr("id").substring(8),"FASTA");e+="\n"}):e=Oa(g("#currentAlignmentIndex").val(),g("#alignmentFormatSelect").val());g("#formattedAlignmentTextarea").val(e);g("#formattedAlignmentTextarea").focus();g("#formattedAlignmentTextarea").select()}function Oa(e,d){d||(d="fasta");var f=g("#alignNameTbl"+
e),a=g("#alignTbl"+e),l=[],k=[],q=[],m=0<g("#alignTbl"+e+" :visible").first().length?":visible":"",n=0;f.find("tr[seqno]"+m).each(function(v,u){parseInt(u.getAttribute("seqno"))>n&&n++}).slice(0,n).each(function(v){var u=g(this).attr("seqno");l[v]=g(this).text();q[v]=g(this).attr("title");breakCount=0;a.find('tr[seqno="'+u+'"]').each(function(y){k[v]||(k[v]="");k[v]+=g(this).find("td").first().text();breakCount+=g(this).find(".insert_l,.insert_r").length});0<breakCount&&(l[v]="MULTIPLE_SEGMENTS_OF_"+
l[v]+" - WARNING - CONTAINS NON-SEQUENTIAL SEGMENTS")});return-1<d.search(/fasta/i)?cb(l,k,q):-1<d.search(/clustal/i)?db(l,k):""}function cb(e,d,f){if(!d||0==d.length)return"No templates selected";for(var a="",l=0;l<e.length;l++){a+=">"+e[l]+(f&&f[l]?" "+f[l]:"")+"\n";for(var k=0;k<d[l].length;k+=72)a+=d[l].substring(k,k+72)+"\n"}return a}function db(e,d){if(!d||0==d.length)return"No templates selected";for(var f=0,a=0;a<e.length;a++)f=Math.max(f,e[a].length);f+=2;for(var l="CLUSTAL\n\n",k=0;k<d[0].length;k+=
60){for(a=0;a<e.length;a++){l+=e[a];for(var q=e[a].length;q<f;q++)l+=" ";l+=d[a].substring(k,k+60)+"\n"}l+="\n"}return l=l.substring(0,l.length-2)}function eb(e){$alignNameTbl=F(e);var d=e.closest(".alignTblContainer").outerWidth(),f=e.closest(".alignTblContainer").outerHeight();d+=10;var a='<svg xmlns="http://www.w3.org/2000/svg"  width="'+d+'" height="'+f+'"><rect x="0" y="0" fill="white" width="'+d+'" height="'+f+'"/>',l,k=$alignNameTbl.outerWidth()+10,q=$alignNameTbl.offset().left-10,m=e.find("td:eq(0)");
d=m.outerWidth();var n=g("<div>").append(g("#"+e.attr("id")+"_features svg").first().clone()).html().replace(/name="[\d_]+" /g,"").replace(/r="4" /g,"");a+='<defs><clipPath id="cp2"><rect x="0" y="0" width="'+d+'" height="'+f+'"/></clipPath></defs>';a+='<g transform="translate('+k+',0)" clip-path="url(#cp2)">';a+=n.substring(n.indexOf("</defs>")+7,n.indexOf("</svg>"));a+="</g>";f=e.find("tr:visible");f.each(function(y,w){g(this).find("span.ligandContact").each(function(z,t){l=w.offsetTop+t.offsetTop;
v||(v=g(t).outerWidth(),u=g(t).outerHeight());g(t).css("color");a+='<rect style="fill:#CC4444;fill-opacity:0.8;" width="'+v+'" height="'+u+'" x="'+(g(t).offset().left-q)+'" y="'+l+'" />'})});a+='<text text-anchor="end" font-size="'+m.css("font-size")+"\" font-family='"+m.css("font-family")+"'>";f=$alignNameTbl.find("tr:visible");f.each(function(y,w){var z=g(this).find("td").css("padding-top");z=parseInt(z.substring(0,z.length-2));l=w.offsetTop+12+z;a+='<tspan x="'+(k-2)+'" y="'+l+'">'+w.textContent.replace("QMEAN",
"")+"</tspan>"});a+="</text>";f=e.find("tr:visible");var v,u;f.offset();f.each(function(y,w){a+='<text text-anchor="middle" font-size="'+m.css("font-size")+"\" font-family='"+m.css("font-family")+"'>";g(this).find("span").each(function(z,t){v||(v=g(t).outerWidth(),u=g(t).outerHeight());if("relative"!=t.style.position){var A=g(t).css("color");A="fill:"+A+";";"bold"==t.style.fontWeight&&(A+="font-weight:bold;");0<A.length&&(A=' style="'+A+'" ');l=w.offsetTop+t.offsetTop+12;a+='<tspan x="'+(g(t).offset().left-
q+v/2)+'" y="'+l+'"'+A+">"+t.textContent+"</tspan>"}});a+="</text>";(td=g(this).find("td")[1])&&(a+='<text text-anchor="start" font-size="'+m.css("font-size")+"\" font-family='"+m.css("font-family")+"'><tspan x=\""+(g(td).offset().left-q+10)+'" y="'+l+'">'+td.textContent+"</tspan></text>")});f.each(function(y,w){g(this).find("span").not(".ligandContact").each(function(z,t){l=w.offsetTop+t.offsetTop;var A=g(t).css("backgroundColor");A&&"transparent"!=A&&"rgb(255, 255, 255)"!=A&&(a+='<rect x="'+(g(t).offset().left-
q)+'" y="'+l+'" width="'+v+'" height="'+u+'" style="fill:'+A+';"/>')})});return a+"</svg>"}var Ba={gapChar:"-"},Va=!1,Fa=!1,fa=null,Da=0,ya=0,Ja=!1,va=0,Ea=0,ja=[[136,221,204],[213,178,64],[187,187,221],[255,136,119],[136,187,221],[255,187,102],[187,221,102],[255,204,238],[166,206,227],[187,136,187],[204,238,204],[166,206,227]],Ga={init:function(e){Va||(Va=!0,g(document).keydown(function(d){if(Fa&&1>g(".fancybox-desktop:visible").length)a:if(Ja)d.preventDefault();else{var f=g("span.cursor").closest(".alignTbl");
if(32==d.keyCode)d.preventDefault(),ra();else if(8==d.keyCode||46==d.keyCode)d.preventDefault(),qa(8==d.keyCode);else if(27==d.keyCode){f.data("startEditRegion",null);f.data("endEditRegion",null);g(".shadowCursor").removeClass("shadowCursor");break a}else if((d.ctrlKey||d.metaKey)&&90==d.keyCode){d=g("body").data("editHistory");if(!(null==d||1>d.length)){d=d.pop();ea(f,d,!0,!0);var a=g(".alignTbl").not(f);0<a.length&&(ea(a,d,!0,!1),g(".cursor").removeClass("cursor"),f.find("tr[seqno="+fa.seqno+"]").find("span").eq(fa.seqidx).addClass("cursor"))}break a}sa(null,
d)}else 27==d.keyCode&&(g(".hoverResidue").removeClass("hoverResidue"),g(".selectResidue").removeClass("selectResidue"))}));return this.each(function(){var d=g.extend({},{type:"target-template",chaingroups:[],keyseq_sequence:e.keyseq_sequence,keyseq_chain_name:e.keyseq_chain_name?e.keyseq_chain_name:["A"],keyseq_annotation:e.keyseq_annotation},e.templateData);e.nowrap&&(d.nowrap=!0);if(e.charts&&e.keyseq_annotation){d.qmLength=0;d.charts=e.charts;for(key in e.keyseq_annotation)break;e.keyseq_annotation[key].qmean&&
(d.pageResidueCount=e.pageResidueCount,Da=48);ya=12}e.resetColourCycle&&(va=0);e.firstDraw=!0;g(this).data("templateData",d);J(g(this),null,e);Ga.toggleIdenticalSeqs.call(this,{chaingroups:d.chaingroups},!1);Ga.resizeToParent.call(g(this),{redrawAnnotation:!1});ma(g(this));R(g(this))})},toggleIdenticalSeqs:function(e,d){return g(this).each(function(){for(var f=g(this),a=F(f),l=0;l<e.chaingroups.length;l++){var k=e.chaingroups[l].filter(function(){return!0});if(!(2>k.length)){var q=k[0],m=a.find('tr[chain="'+
q+'"]').first().text(),n=m.substring(0,m.lastIndexOf(".")+1)+"("+k.join("")+")";m=m.substring(0,m.lastIndexOf("."))+"."+q.charAt(0);for(var v="",u=1;u<k.length;u++)v+="[chain="+k[u]+"]",u<k.length-1&&(v+=",");f.find("tr"+v).toggle();a.find("tr"+v).toggle();"none"==a.find("tr[chain="+k[1]+"]").css("display")?a.find("tr[chain="+q+"]").find("td").html(n):a.find("tr[chain="+q+"]").find("td").html(m)}}("undefined"==typeof d||d)&&ma(f)})},drawAlignment:function(e){return this.each(function(){J(g(this),
e?e.seqs:null,e?e:null);R(g(this))})},getFormattedAlignment:function(e){return Oa(g(this).attr("id").substring(8),e.format)},exportAlignment:function(e){return this.each(function(){g("#formattedAlignment").show();g("#alignmentFormatSelect").val(e.format);Ua();g("<a href='#formattedAlignment' title='Copy & Paste Alignment'/>'").fancybox({helpers:{title:{type:"inside"}}}).trigger("click");g("#formattedAlignmentTextarea").focus();g("#formattedAlignmentTextarea").select()})},html2image:function(e){g.fancybox.close();
g(".popover").hide();e=g("#currentAlignmentIndex").val();$alTbl=g("#alignTbl"+e);e=eb($alTbl);e=new Blob([e],{type:"image/svg+xml;charset=utf-8"});e=(window.URL||window.webkitURL||window).createObjectURL(e);var d=new Image,f=document.createElement("canvas"),a=f.getContext("2d");d.onload=function(){f.width=this.naturalWidth;f.height=this.naturalHeight;a.drawImage(this,0,0);f.toBlob(function(l){saveAs(l,"alignment.png")},"image/png")};d.src=e},colourAllAlignments:function(e){resetChainMappingColours();
e.features?g(".alignTbl").each(function(){var d=[];g(this).find("tr[struc_id]").each(function(a,l){var k=l.getAttribute("struc_id");-1==d.indexOf(k)&&d.push(k)});var f={};for(struc_id in e.features)-1<d.indexOf(struc_id)&&(f[struc_id]=e.features[struc_id]);0==Object.keys(f).length?g(this).removeData("features"):g(this).data("features",f);za("features",g(this))}):(e.col?e.col!=chainMapping.defaultColourScheme&&e.col!=jQuery.cookie("colourScheme")&&jQuery.cookie("colourScheme",e.col,{expires:365,path:"/"}):
(e.col=chainMapping.defaultColourScheme,e.col||(e.col=jQuery.cookie("colourScheme"))),g(".alignTbl").each(function(){g(this).removeData("features");za(e.col,g(this))}));ca()},changeExportFormat:function(e){return this.each(function(){Ua()})},secondaryStructure:function(e){e&&jQuery.cookie("secStruct",e.sstype,{expires:365,path:"/"});var d=null;d=e?e.sstype:g.cookie("secStruct");null==d&&(d="dssp");ya="none"==d?0:12;e=this.each(function(){g(this).data("templateData")&&(ma(g(this)),"secstruc"==g.cookie("colourScheme")&&
za("secstruc",g(this)))});var f=null,a=null;f=null;"undefined"!=typeof globalTemplateData?(g("#alignTbl"),"undefined"!=typeof globalTemplateData&&(a=globalTemplateData)):g(this).data("templateData")&&("model-template"==g(this).data("templateData").type?f=!0:(a=[],this.each(function(){g(this).data("templateData")&&(a=a.concat(g(this).data("templateData").templates))})));if(0<g("#pv:visible",currentWin.document).length)if(f)this.each(function(){var u=g(this).data("templateData");if(u){var y=u.struc_id;
if(pv_viewer.get(y)){var w=pv_viewer.get(y).structure();pv_viewer.rm(y);var z="none"==d;if(!z)for(var t=0;t<u.keyseq_chain_name.length;t++){var A=u.keyseq_chain_name[t],I=u.templates[0].trg_offset;I||(I=1);var K=u.keyseq_annotation[A][d+"_string"];A=w.select({chain:A});K?A.eachResidue(function(G){G.full().setSS(K[G.num()-I])}):z=!0}z&&w.select("protein").eachResidue(function(G){G.full().setSS("")});pv_viewer.cartoon(y,w,{color:pv.color.uniform("white")})}}});else for(var l=0;l<a.length;l++){if(a[l].selected){var k=
a[l].struc_id;f=pv_viewer.get(k).structure();pv_viewer.rm(k);if("none"==d)f.select("protein").eachResidue(function(u){u.full().setSS("")});else if(a[l].targets)for(var q=0;q<a[l].targets.length;q++)for(var m=a[l].targets[q],n=0;n<m.chain.length;n++)(v=m.annotation[m.chain[n]][d+"_string"])||(v=m.annotation[m.chain[n]][d]),f.select({chain:m.chain[n]}).eachResidue(function(u){u.full().setSS(v[u.num()-1])});else{var v=a[l].annotation[d+"_string"];v||(v=a[l].annotation[d]);f.select({chain:a[l].chain}).eachResidue(function(u){u.full().setSS(v?
v[u.num()-1]:"")})}pv_viewer.cartoon(k,f,{color:pv.color.uniform("white")})}}else if(0<g("#ngl:visible",currentWin.document).length)if(f)this.each(function(){var u=g(this).data("templateData");if(u)for(var y=u.struc_id,w="none"==d,z=0;z<u.keyseq_chain_name.length;z++){var t=u.keyseq_chain_name[z],A=u.templates[0].trg_offset;A||(A=1);var I=u.keyseq_annotation[t][d+"_string"];I||(w=!0);for(comp in ngl_stage.compList)if(ngl_stage.compList[comp].name==y){ngl_stage.compList[comp].structure.eachResidue(function(K){K.chainname==
t&&(K.sstruc=w?"":I[K.resno-A].toLowerCase())});break}}});else for(l=0;l<a.length;l++)if(a[l].selected){ngl_stage.eachRepresentation(function(u){if(u.name&&!u.name.match(/(ligands|dna|over)/)){var y=u.name;for(comp in ngl_stage.compList)ngl_stage.compList[comp].name==y&&ngl_stage.compList[comp].removeRepresentation(u)}});if("none"==d)for(comp in ngl_stage.compList)ngl_stage.compList[comp].name==a[l].struc_id&&ngl_stage.compList[comp].structure.eachResidue(function(u){u.sstruc=""});else if(a[l].targets)for(q=
0;q<a[l].targets.length;q++)for(m=a[l].targets[q],n=0;n<m.chain.length;n++)for(comp in(v=m.annotation[m.chain[n]][d+"_string"])||(v=m.annotation[m.chain[n]][d]),ngl_stage.compList){if(ngl_stage.compList[comp].name==a[l].struc_id){ngl_stage.compList[comp].structure.eachResidue(function(u){u.chainname==m.chain[n]&&(u.sstruc=v[u.resno-1].toLowerCase())});break}}else for(comp in v=a[l].annotation[d+"_string"]?a[l].annotation[d+"_string"]:a[l].annotation[d],ngl_stage.compList)if(ngl_stage.compList[comp].name==
a[l].struc_id){ngl_stage.compList[comp].structure.eachResidue(function(u){u.chainname==a[l].chain&&(u.sstruc=v?v[u.resno-1].toLowerCase():"")});break}k=a[l].struc_id;for(comp in ngl_stage.compList)ngl_stage.compList[comp].name==k&&ngl_stage.compList[comp].addRepresentation("cartoon",{name:k,sele:"not :_ and not nucleic and not :-",smoothSheet:!0,aspectRatio:6,roughness:1})}changeRep(g.cookie("defaultRepr"));ca();return e},targetMismatch:function(e){e.match?jQuery.cookie("targetMismatch",e.match,{expires:365,
path:"/"}):jQuery.removeCookie("targetMismatch",{path:"/"});return this.each(function(){g(this).find("span.targetMismatch").removeClass("targetMismatch");if("fade"==e.match)g("#enhanceMismatch_cb").prop("checked",!1),g(this).find("span[nm]").addClass("targetMismatch");else if("enhance"==e.match){g("#fadeMismatch_cb").prop("checked",!1);var d=g(this).find("span");d.not("[nm]").addClass("targetMismatch");d.not("[s]").addClass("targetMismatch")}})},viewerInitialised:function(e){var d=chainMapping.defaultColourScheme?
chainMapping.defaultColourScheme:g(this).data("features")?"features":g.cookie("colourScheme");-1<["qmean_local","confClass","bfactor","bfactor_range","secstruc"].indexOf(d)?g(".alignTbl:first").alignment("colourAllAlignments",{col:d}):ca(e);0<g("#pv:visible",currentWin.document).length&&pv_viewer.fitParent()},updateColoursSingleResidue:function(e){ca({singleResidue:e})},resizeToParent:function(e,d){d=e?e.redrawAnnotation:!0;return this.each(function(){var f=g(this);if(f.is(":visible")&&f.data("templateData")){var a=
g(this).find("tr:visible td").first(),l=a.find("span").first()[0];if(l){var k=f.width()-a.width(),q=f.parent().closest("table").parent();q=q.width()-(f.offset().left-q.offset().left)-k;f.data("templateData").nowrap&&(q=1E7);k=a.text().length;l=Math.floor(q/l.getBoundingClientRect().width);f.data("options").textOnly&&(l=Math.floor(q/(a.width()/a.text().length)));l-=l%5;1>l&&(l=5);a=0<f.find("tr:hidden").length;q=f.data("templateData").chaingroups;l!=k?(f.attr("cols_cookie")&&g.cookie(f.attr("cols_cookie"),
l,{expires:365,path:"/"}),J(f,null,{cols:l}),d&&ma(f),a&&Ga.toggleIdenticalSeqs.call(f,{chaingroups:q})):(d&&ma(f),g("#"+f.attr("id")+"_features").css("top",f.position().top))}}})},toggleEditMode:function(e){g(this).attr("id").substring("8");(Fa=e&&null!=e.edit?e.edit:!Fa)?(g("a[id^=gapEdit_]").css("opacity",1),g(".hoverResidue").removeClass("hoverResidue"),null==fa&&(fa={seqno:1,seqidx:0}),g(this).find("tr[seqno="+fa.seqno+"]").find("span").eq(fa.seqidx).addClass("cursor")):(g("a[id^=gapEdit_]").css("opacity",
.6),g(".cursor").removeClass("cursor"))},removeGappedColumns:function(e){e=g(this).data("templateData").templates;var d=e[0].trg_seq;for(var f=e[0].tpl_seq,a="",l="",k=0;k<d.length;k++)if("-"!=d.charAt(k)||"-"!=f.charAt(k))a+=d.charAt(k),l+=f.charAt(k);d=[a,l];e[0].trg_seq=d[0];e[0].tpl_seq=d[1];J(g(this))}},Pa={},$a=[238,51,17],Ra=[17,119,238],La=[17,204,17],Ya=[255,102,0],ab=[17,187,187],Za=[238,119,119],Qa=[204,68,204],Xa=[204,204,0],xa={A:{name:"Alanine",triplet:"ALA",hydrophobic:.7,size:.11},
C:{name:"Cysteine",triplet:"CYS",hydrophobic:.78,size:.35},D:{name:"Aspartate",triplet:"ASP",hydrophobic:.11,size:.45},E:{name:"Glutamate",triplet:"GLU",hydrophobic:.11,size:.56},F:{name:"Phenylalanine",triplet:"PHE",hydrophobic:.81,size:.7},G:{name:"Glycine",triplet:"GLY",hydrophobic:.46,size:0},H:{name:"Histidine",triplet:"HIS",hydrophobic:.14,size:.62},I:{name:"Isoleucine",triplet:"ILE",hydrophobic:1,size:.43},K:{name:"Lysine",triplet:"LYS",hydrophobic:.07,size:.55},L:{name:"Leucine",triplet:"LEU",
hydrophobic:.92,size:.43},M:{name:"Methionine",triplet:"MET",hydrophobic:.71,size:.57},N:{name:"Asparagine",triplet:"ASN",hydrophobic:.11,size:.44},P:{name:"Proline",triplet:"PRO",hydrophobic:.32,size:.31},Q:{name:"Glutamine",triplet:"GLN",hydrophobic:.11,size:.55},R:{name:"Arginine",triplet:"ARG",hydrophobic:0,size:.77},S:{name:"Serine",triplet:"SER",hydrophobic:.41,size:.23},T:{name:"Threonine",triplet:"THR",hydrophobic:.42,size:.34},V:{name:"Valine",triplet:"VAL",hydrophobic:.97,size:.32},W:{name:"Tryptophan",
triplet:"TRP",hydrophobic:.4,size:1},Y:{name:"Tyrosine",triplet:"TYR",hydrophobic:.36,size:.82},B:{name:"Aspartate or Asparagine",triplet:"ASX"},Z:{name:"Glutamate or Glutamine",triplet:"GLX"},J:{name:"Leucine or Isoleucine",triplet:"XLE"},X:{name:"Unknown",triplet:"UNC"},"?":{name:"Unknown",triplet:"UNC"},hydrophobic:"LIFWVM",polar:"RKDENQ",small:"TDN",large:"WYRFH",aliphatic:"ILV",charged:"HKRED",positive:"HKR",negative:"ED",tiny:"AGS",aromatic:"FYWH",proline:"P",serThr:"ST"};g.fn.alignment=function(e){if(Ga[e])return Ga[e].apply(this,
Array.prototype.slice.call(arguments,1));if("object"!==typeof e&&e)g.error("Method "+e+" does not exist on alignment.min.js");else return Ga.init.apply(this,arguments)}})(jQuery);Object.keys||(Object.keys=function(g){var F=[],R;for(R in g)g.hasOwnProperty(R)&&F.push(R);return F});$(document).on("click",".alignmentOptions input[name=csRadioGroup]",function(){delete chainMapping.defaultColourScheme;$(".alignTbl:first").alignment("colourAllAlignments",{col:$(this).val()})});
$(document).on("click","#viewerSelect input[name=3dRG]",function(){showViewer($(this).val())});
$("body").on("highlightResidue",function(g,F){if("alignment"!=F.src){F.multiple||$(".hoverResidue").removeClass("hoverResidue");var R=$('.alignTbl tr[struc_id^="'+F.struc_id+'"]:visible');0==R.length&&(R=$('.alignTbl tr[tpl_id="'+F.struc_id+'"]:visible'));if(0<R.length){var T=R.filter('[chain="'+F.chain+'"]');0==T.length&&(T=R.filter('[keyseqchain="'+F.chain+'"]'));0<T.length&&T.find("span[s="+F.resno+"]").addClass("hoverResidue")}}}).on("selectResidue",function(g,F){if("alignment"!=F.src){$(".hoverResidue").removeClass("hoverResidue");
$(".selectResidue").removeClass("selectResidue");var R=$('.alignTbl tr[struc_id^="'+F.struc_id+'"]:visible');0==R.length&&(R=$('.alignTbl tr[tpl_id="'+F.struc_id+'"]:visible'));if(0<R.length){var T=R.filter('[chain="'+F.chain+'"]');0==T.length&&(T=R.filter('[keyseqchain="'+F.chain+'"]'));0<T.length&&T.find("span[s="+F.resno+"]").addClass("selectResidue")}}});
$("body").on("click",function(g){$(".poponthis").each(function(){$(this).is(g.target)||0!==$(this).has(g.target).length||0!==$(".popover").has(g.target).length||((($(this).popover("hide").data("bs.popover")||{}).inState||{}).click=!1)})});
function addSettingsPopover(){$("a[id^=options_]").css("visibility","visible").each(function(){$(this).popover({html:!0,placement:$(this).attr("pop-placement")?$(this).attr("pop-placement"):"auto",content:$("#alignmentOptions"),container:1==$(this).closest("#viewerWrapper").length?"#right-panel":"body"})}).on("show.bs.popover",function(g){var F=$(this).attr("id").substring(8);$(this).data("bs.popover").$tip.find("#exportOptions");$("#currentAlignmentIndex").val(F);1==$("#exportOptions").length?($("#alignmentOptions").show(),
""==F?$("#exportOptions").hide():$("#exportOptions").show()):$("a[id^=options_]").each(function(){$(this).data("bs.popover")&&$(this).data("bs.popover").$tip&&1==$(this).data("bs.popover").$tip.find("#exportOptions").length&&(""==F?$(this).data("bs.popover").$tip.find("#exportOptions").hide():$(this).data("bs.popover").$tip.find("#exportOptions").show())})})}addSettingsPopover();
0<$("#bgColSlider").length&&$("#bgColSlider").slider({value:$.cookie("bg_r")?$.cookie("bg_r"):255,min:0,max:255,step:1,slide:function(g,F){pv_viewer.options("background",[F.value/255,F.value/255,F.value/255]);ngl_stage&&ngl_stage.setParameters({backgroundColor:"rgb("+F.value+","+F.value+","+F.value+")"});jQuery.cookie("bg_r",F.value,{expires:365,path:"/"})},change:function(g,F){pv_viewer.options("background",[F.value/255,F.value/255,F.value/255]);ngl_stage&&ngl_stage.setParameters({backgroundColor:"rgb("+
F.value+","+F.value+","+F.value+")"});jQuery.cookie("bg_r",F.value,{expires:365,path:"/"});180>F.value?$(".viewerStatus").addClass("status_dark"):$(".viewerStatus").removeClass("status_dark")}});$.cookie("bg_r")&&180>$.cookie("bg_r")&&$(".viewerStatus").addClass("status_dark");function resetChainMappingColours(){for(s in chainMapping.structures)for(c in chainMapping.structures[s])for(r in chainMapping.structures[s][c])delete chainMapping.structures[s][c][r].rgb}
var chainMapping={structures:{},targets:{},alignments:[],chainMeta:{},annotations:[{key:"qm",label:"Confidence",active:!0},{key:"qmb",label:"QMEANBrane",active:!1},{key:"c",label:"Consistency",active:!0},{key:"entropy",label:"Entropy",active:!0},{key:"soa",label:"Solvent Accessibility",active:!0},{key:"bfactor",label:"B-factor",active:!0},{key:"bfactor_range",label:"B-factor range",active:!0}]},annotationsModified=!1;
$("#annotate").on("keyup",function(g){var F=g.keyCode?g.keyCode:g.which;"keyup"==g.type&&13==F?processAnnotations():annotationsModified=!0});
$("body").on("centerResRange selectResidue",function(g,F){if(F.struc_id&&0!=$("#annotate:visible").length){var R=F.resno,T=F.resno;null==R&&(R=F.min,T=F.max);for(var S in modelData)if("model_"+S==F.struc_id){for(var da=0;da<modelData[S].targets.length;da++){var ea=modelData[S].targets[da],W=ea.target_sequence,sa=ea.id,ra=0;W||(W=ea.templates[0].trg_seq,ea.templates[0].tpl_seq&&(W=W.replaceAll("-","")),sa=ea.keyseq_chain_name,ea.templates[0].trg_offset&&(ra=ea.templates[0].trg_offset-1));if(-1<sa.indexOf(F.chain)){ea=
W.substring(R-1-ra,T-ra);W=$("#annotate").val();"\n"!=W.charAt(W.length-1)&&(W+="\n");W+="motif="+ea;1<modelData[S].targets.length&&(W+=" target="+(da+1));$("#annotate").val(W+" start="+R+" end="+T+"\n").scrollTop($("#annotate")[0].scrollHeight);break}}break}}});
function processAnnotations(g){0<$("#pv:visible",currentWin.document).length&&(pv_viewer.rm("model_"+(g?g:"*")+".label"),pv_viewer.rm("model_"+(g?g:"*")+".selected"));if(0<$("#ngl:visible",currentWin.document).length)for(var F in modelData)if(!g||F==g){var R=getNGLComponentByName("model_"+F);if(R){for(var T=[],S=0;S<R.reprList.length;S++)(-1<R.reprList[S].name.indexOf(".label")||-1<R.reprList[S].name.indexOf(".selected"))&&T.push(R.reprList[S]);for(S=0;S<T.length;S++)R.removeRepresentation(T[S])}}R=
[];T=$("#annotate").val().split(/\r?\n/);F={};S={};for(var da=0;da<T.length;S={$jscomp$loop$prop$label$96:S.$jscomp$loop$prop$label$96},da++){var ea=void 0,W=void 0,sa=void 0,ra=void 0,ta=void 0,qa=void 0;S.$jscomp$loop$prop$label$96=void 0;var Ca=!1;T[da]=T[da].trim().replace(/\s{1,}/g," ").replace(/\s*= */g,"=");var X=T[da];if(-1<X.search(/label="(.+)"/i)){var J=X.match(/label="(.+)" ?/i);S.$jscomp$loop$prop$label$96=J[1];X=X.replace(J[0],"").trim()}J=!1;X=X.split(" ");for(var P=0;P<X.length;P++){var Y=
X[P].split("=");if(2!=Y.length)J=!0;else switch(Y[0].toUpperCase()){case "MOTIF":ea=Y[1];break;case "COLOUR":case "COLOR":W=new NGL.Color(Y[1].toLowerCase());W=255*W.r+","+255*W.g+","+255*W.b;break;case "TARGET":sa=parseInt(Y[1]);break;case "CHAIN":ra=Y[1];break;case "START":ta=parseInt(Y[1]);break;case "END":qa=parseInt(Y[1]);break;case "LABEL":S.$jscomp$loop$prop$label$96=Y[1];break;case "SIDECHAINS":Ca="on"==Y[1];break;default:J=!0}}if(ea){X=!1;try{rxtest=RegExp(ea,"g"),X=!0}catch(pa){}X||(console.error("Motif regex is invalid"),
J=!0)}null!=W||null!=S.$jscomp$loop$prop$label$96||Ca||(J=!0);if(J)0<T[da].length&&"?"!=T[da].charAt(0)?R.push("?"+T[da]):R.push(T[da]);else{R.push(T[da]);J={};for(var Ka in modelData){J.$jscomp$loop$prop$mkey$69$94=Ka;if(!modelData[J.$jscomp$loop$prop$mkey$69$94].status||"COMPLETED"==modelData[J.$jscomp$loop$prop$mkey$69$94].status){J.$jscomp$loop$prop$viewSelect$93={};for(X=0;X<modelData[J.$jscomp$loop$prop$mkey$69$94].targets.length;X++)if(null==sa||sa==X+1){var U=modelData[J.$jscomp$loop$prop$mkey$69$94].targets[X];
P=U.target_sequence;Y=U.id;P||(P=U.templates[0].trg_seq,U.templates[0].tpl_seq&&(P=P.replaceAll("-","")),Y=U.keyseq_chain_name,U.templates[0].trg_offset&&(P="-".repeat(U.templates[0].trg_offset-1)+P));"string"!==typeof Y&&(Y=Y.join(""));F["model_"+J.$jscomp$loop$prop$mkey$69$94]||(F["model_"+J.$jscomp$loop$prop$mkey$69$94]=[]);U=ea;null==U&&(U=P.substring(ta?ta-1:0,qa?qa:P.length));for(var Z=0;Z<Y.length;Z++){var ua=Y.charAt(Z);if(null==ra||ua==ra){J.$jscomp$loop$prop$viewSelect$93[ua]||(J.$jscomp$loop$prop$viewSelect$93[ua]=
{labelled:[],selected:[]});for(var za=$jscomp.makeIterator(P.matchAll(RegExp(U,"g"))),la=za.next();!la.done;la=za.next()){var ka=la.value,ca=ka.index+1;la=ca+ka[0].length-1;4==ka.length&&(ca+=ka[1].length,la=ca+ka[2].length-1);if(!(ta&&ta>la||qa&&qa<ca)&&(ta&&(ca=Math.max(ca,ta)),qa&&(la=Math.min(la,qa)),W&&F["model_"+J.$jscomp$loop$prop$mkey$69$94].push({frmChn:ua,toChn:ua,resStart:ca,resEnd:la,rgb:W}),S.$jscomp$loop$prop$label$96||Ca)){S.$jscomp$loop$prop$label$96&&"default"==S.$jscomp$loop$prop$label$96.toLowerCase()&&
(S.$jscomp$loop$prop$label$96="default");for(ka=Math.floor((la-ca)/2)+ca;ca<=la;ca++)Ca&&J.$jscomp$loop$prop$viewSelect$93[ua].selected.push(ca),"default"==S.$jscomp$loop$prop$label$96&&J.$jscomp$loop$prop$viewSelect$93[ua].labelled.push(ca);S.$jscomp$loop$prop$label$96&&"default"!=S.$jscomp$loop$prop$label$96&&J.$jscomp$loop$prop$viewSelect$93[ua].labelled.push(ka)}}}}}if((S.$jscomp$loop$prop$label$96||Ca)&&(null==g||g==J.$jscomp$loop$prop$mkey$69$94))if(0<$("#pv:visible",currentWin.document).length)(X=
pv_viewer.get("model_"+J.$jscomp$loop$prop$mkey$69$94))&&(X=X.structure().residueSelect(function(pa,Ma){return function(oa){if(pa.$jscomp$loop$prop$viewSelect$93[oa.chain().name()]&&(-1<pa.$jscomp$loop$prop$viewSelect$93[oa.chain().name()].selected.indexOf(oa.num())||-1<pa.$jscomp$loop$prop$viewSelect$93[oa.chain().name()].labelled.indexOf(oa.num())))return-1<pa.$jscomp$loop$prop$viewSelect$93[oa.chain().name()].labelled.indexOf(oa.num())&&oa.eachAtom(function(ma){"CA"==ma.name()&&pv_viewer.label("model_"+
pa.$jscomp$loop$prop$mkey$69$94+".label","default"!=Ma.$jscomp$loop$prop$label$96?Ma.$jscomp$loop$prop$label$96:ma.residue()._name+" "+ma.residue()._chain.name()+ma.residue().num(),ma.pos(),{fontSize:12,fontColor:"#CCC"})}),-1<pa.$jscomp$loop$prop$viewSelect$93[oa.chain().name()].selected.indexOf(oa.num())}}(J,S)))&&pv_viewer.ballsAndSticks("model_"+J.$jscomp$loop$prop$mkey$69$94+".selected",X);else if(0<$("#ngl:visible",currentWin.document).length&&(X=getNGLComponentByName("model_"+J.$jscomp$loop$prop$mkey$69$94))){P=
"";Y=!1;for(chn in J.$jscomp$loop$prop$viewSelect$93)if(0!=J.$jscomp$loop$prop$viewSelect$93[chn].labelled.length){0<P.length&&(P+=" or ");P+="( :"+chn+" and (";U=null;for(Z=0;Z<J.$jscomp$loop$prop$viewSelect$93[chn].labelled.length;Z++)Y=!0,U&&J.$jscomp$loop$prop$viewSelect$93[chn].labelled[Z]==U+1||(U&&(P+="-"+U),0<Z&&(P+=" or "),P+=J.$jscomp$loop$prop$viewSelect$93[chn].labelled[Z]),U=J.$jscomp$loop$prop$viewSelect$93[chn].labelled[Z];U&&(P+="-"+U);P+=") and .CA) "}Y&&X.addRepresentation("label",
{name:"model_"+J.$jscomp$loop$prop$mkey$69$94+".label",sele:P,labelType:"format",labelFormat:"default"!=S.$jscomp$loop$prop$label$96?S.$jscomp$loop$prop$label$96:"%(resname)s %(chainname)s%(resno)s",fontWeight:"bold",radiusScale:1.4,xOffset:.3});P="";Y=!1;for(chn in J.$jscomp$loop$prop$viewSelect$93)if(0!=J.$jscomp$loop$prop$viewSelect$93[chn].selected.length){0<P.length&&(P+=" or ");P+="( :"+chn+" and (";U=null;for(Z=0;Z<J.$jscomp$loop$prop$viewSelect$93[chn].selected.length;Z++)Y=!0,U&&J.$jscomp$loop$prop$viewSelect$93[chn].selected[Z]==
U+1||(U&&(P+="-"+U),0<Z&&(P+=" or "),P+=J.$jscomp$loop$prop$viewSelect$93[chn].selected[Z]),U=J.$jscomp$loop$prop$viewSelect$93[chn].selected[Z];U&&(P+="-"+U);P+=")) "}Y&&X.addRepresentation("ball+stick",{name:"model_"+J.$jscomp$loop$prop$mkey$69$94+".selected",sele:P,colorScheme:"element"})}}J={$jscomp$loop$prop$viewSelect$93:J.$jscomp$loop$prop$viewSelect$93,$jscomp$loop$prop$mkey$69$94:J.$jscomp$loop$prop$mkey$69$94}}}}g||(g=R.join("\n"),"undefined"!==typeof annotationsURL&&-1==g.search(/^\?/m)&&
$.ajax({type:"POST",url:annotationsURL,data:{annotations:g,csrfmiddlewaretoken:csrf},success:function(pa){annotationsModified=!1},error:function(pa){console.error(pa)}}),chainMapping.defaultColourScheme="features",$("#annotate").val()!=g&&$("#annotate").val(g),$(".alignTbl:first").alignment("colourAllAlignments",{features:F}))};